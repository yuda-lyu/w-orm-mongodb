/*!
 * w-orm-mongodb v1.1.29
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["events","mongodb","stream"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-orm-mongodb"]=e(t.events,t.mongodb,t.stream)}(this,(function(t,e,r){"use strict";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(){this.__data__=[],this.size=0};var a=function(t,e){return t===e||t!=t&&e!=e},i=a;var c=function(t,e){for(var r=t.length;r--;)if(i(t[r][0],e))return r;return-1},f=c,l=Array.prototype.splice;var s=c;var v=c;var d=c;var p=u,b=function(t){var e=this.__data__,r=f(e,t);return!(r<0)&&(r==e.length-1?e.pop():l.call(e,r,1),--this.size,!0)},y=function(t){var e=this.__data__,r=s(e,t);return r<0?void 0:e[r][1]},h=function(t){return v(this.__data__,t)>-1},j=function(t,e){var r=this.__data__,n=d(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function g(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}g.prototype.clear=p,g.prototype.delete=b,g.prototype.get=y,g.prototype.has=h,g.prototype.set=j;var _=g,w=_;var m=function(){this.__data__=new w,this.size=0};var O=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var A=function(t){return this.__data__.get(t)};var S=function(t){return this.__data__.has(t)},k="object"==typeof n&&n&&n.Object===Object&&n,P=k,x="object"==typeof self&&self&&self.Object===Object&&self,z=P||x||Function("return this")(),E=z.Symbol,B=E,F=Object.prototype,M=F.hasOwnProperty,I=F.toString,U=B?B.toStringTag:void 0;var N=function(t){var e=M.call(t,U),r=t[U];try{t[U]=void 0;var n=!0}catch(t){}var o=I.call(t);return n&&(e?t[U]=r:delete t[U]),o},C=Object.prototype.toString;var D=N,T=function(t){return C.call(t)},$=E?E.toStringTag:void 0;var G=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":$&&$ in Object(t)?D(t):T(t)};var R=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},L=G,V=R;var q,W=function(t){if(!V(t))return!1;var e=L(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},H=z["__core-js_shared__"],J=(q=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"";var K=function(t){return!!J&&J in t},Q=Function.prototype.toString;var X=function(t){if(null!=t){try{return Q.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Y=W,Z=K,tt=R,et=X,rt=/^\[object .+?Constructor\]$/,nt=Function.prototype,ot=Object.prototype,ut=nt.toString,at=ot.hasOwnProperty,it=RegExp("^"+ut.call(at).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ct=function(t){return!(!tt(t)||Z(t))&&(Y(t)?it:rt).test(et(t))},ft=function(t,e){return null==t?void 0:t[e]};var lt=function(t,e){var r=ft(t,e);return ct(r)?r:void 0},st=lt(z,"Map"),vt=lt(Object,"create"),dt=vt;var pt=function(){this.__data__=dt?dt(null):{},this.size=0};var bt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yt=vt,ht=Object.prototype.hasOwnProperty;var jt=function(t){var e=this.__data__;if(yt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return ht.call(e,t)?e[t]:void 0},gt=vt,_t=Object.prototype.hasOwnProperty;var wt=vt;var mt=pt,Ot=bt,At=jt,St=function(t){var e=this.__data__;return gt?void 0!==e[t]:_t.call(e,t)},kt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=wt&&void 0===e?"__lodash_hash_undefined__":e,this};function Pt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Pt.prototype.clear=mt,Pt.prototype.delete=Ot,Pt.prototype.get=At,Pt.prototype.has=St,Pt.prototype.set=kt;var xt=Pt,zt=_,Et=st;var Bt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Ft=function(t,e){var r=t.__data__;return Bt(e)?r["string"==typeof e?"string":"hash"]:r.map},Mt=Ft;var It=Ft;var Ut=Ft;var Nt=Ft;var Ct=function(t,e){var r=Nt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},Dt=function(){this.size=0,this.__data__={hash:new xt,map:new(Et||zt),string:new xt}},Tt=function(t){var e=Mt(this,t).delete(t);return this.size-=e?1:0,e},$t=function(t){return It(this,t).get(t)},Gt=function(t){return Ut(this,t).has(t)},Rt=Ct;function Lt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Lt.prototype.clear=Dt,Lt.prototype.delete=Tt,Lt.prototype.get=$t,Lt.prototype.has=Gt,Lt.prototype.set=Rt;var Vt=Lt,qt=_,Wt=st,Ht=Vt;var Jt=_,Kt=m,Qt=O,Xt=A,Yt=S,Zt=function(t,e){var r=this.__data__;if(r instanceof qt){var n=r.__data__;if(!Wt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ht(n)}return r.set(t,e),this.size=r.size,this};function te(t){var e=this.__data__=new Jt(t);this.size=e.size}te.prototype.clear=Kt,te.prototype.delete=Qt,te.prototype.get=Xt,te.prototype.has=Yt,te.prototype.set=Zt;var ee=te;var re=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t},ne=lt,oe=function(){try{var t=ne(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),ue=oe;var ae=function(t,e,r){"__proto__"==e&&ue?ue(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},ie=ae,ce=a,fe=Object.prototype.hasOwnProperty;var le=function(t,e,r){var n=t[e];fe.call(t,e)&&ce(n,r)&&(void 0!==r||e in t)||ie(t,e,r)},se=le,ve=ae;var de=function(t,e,r,n){var o=!r;r||(r={});for(var u=-1,a=e.length;++u<a;){var i=e[u],c=n?n(r[i],t[i],i,r,t):void 0;void 0===c&&(c=t[i]),o?ve(r,i,c):se(r,i,c)}return r};var pe=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var be=function(t){return null!=t&&"object"==typeof t},ye=G,he=be;var je=function(t){return he(t)&&"[object Arguments]"==ye(t)},ge=be,_e=Object.prototype,we=_e.hasOwnProperty,me=_e.propertyIsEnumerable,Oe=je(function(){return arguments}())?je:function(t){return ge(t)&&we.call(t,"callee")&&!me.call(t,"callee")},Ae=Oe,Se=Array.isArray,ke={};var Pe=function(){return!1};!function(t,e){var r=z,n=Pe,o=e&&!e.nodeType&&e,u=o&&t&&!t.nodeType&&t,a=u&&u.exports===o?r.Buffer:void 0,i=(a?a.isBuffer:void 0)||n;t.exports=i}({get exports(){return ke},set exports(t){ke=t}},ke);var xe=/^(?:0|[1-9]\d*)$/;var ze=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&xe.test(t))&&t>-1&&t%1==0&&t<e};var Ee=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Be=G,Fe=Ee,Me=be,Ie={};Ie["[object Float32Array]"]=Ie["[object Float64Array]"]=Ie["[object Int8Array]"]=Ie["[object Int16Array]"]=Ie["[object Int32Array]"]=Ie["[object Uint8Array]"]=Ie["[object Uint8ClampedArray]"]=Ie["[object Uint16Array]"]=Ie["[object Uint32Array]"]=!0,Ie["[object Arguments]"]=Ie["[object Array]"]=Ie["[object ArrayBuffer]"]=Ie["[object Boolean]"]=Ie["[object DataView]"]=Ie["[object Date]"]=Ie["[object Error]"]=Ie["[object Function]"]=Ie["[object Map]"]=Ie["[object Number]"]=Ie["[object Object]"]=Ie["[object RegExp]"]=Ie["[object Set]"]=Ie["[object String]"]=Ie["[object WeakMap]"]=!1;var Ue=function(t){return Me(t)&&Fe(t.length)&&!!Ie[Be(t)]};var Ne=function(t){return function(e){return t(e)}},Ce={};!function(t,e){var r=k,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,u=o&&o.exports===n&&r.process,a=function(){try{var t=o&&o.require&&o.require("util").types;return t||u&&u.binding&&u.binding("util")}catch(t){}}();t.exports=a}({get exports(){return Ce},set exports(t){Ce=t}},Ce);var De=Ue,Te=Ne,$e=Ce&&Ce.isTypedArray,Ge=$e?Te($e):De,Re=pe,Le=Ae,Ve=Se,qe=ke,We=ze,He=Ge,Je=Object.prototype.hasOwnProperty;var Ke=function(t,e){var r=Ve(t),n=!r&&Le(t),o=!r&&!n&&qe(t),u=!r&&!n&&!o&&He(t),a=r||n||o||u,i=a?Re(t.length,String):[],c=i.length;for(var f in t)!e&&!Je.call(t,f)||a&&("length"==f||o&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||We(f,c))||i.push(f);return i},Qe=Object.prototype;var Xe=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Qe)};var Ye=function(t,e){return function(r){return t(e(r))}},Ze=Ye(Object.keys,Object),tr=Xe,er=Ze,rr=Object.prototype.hasOwnProperty;var nr=function(t){if(!tr(t))return er(t);var e=[];for(var r in Object(t))rr.call(t,r)&&"constructor"!=r&&e.push(r);return e},or=W,ur=Ee;var ar=function(t){return null!=t&&ur(t.length)&&!or(t)},ir=Ke,cr=nr,fr=ar;var lr=function(t){return fr(t)?ir(t):cr(t)},sr=de,vr=lr;var dr=function(t,e){return t&&sr(e,vr(e),t)};var pr=R,br=Xe,yr=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},hr=Object.prototype.hasOwnProperty;var jr=Ke,gr=function(t){if(!pr(t))return yr(t);var e=br(t),r=[];for(var n in t)("constructor"!=n||!e&&hr.call(t,n))&&r.push(n);return r},_r=ar;var wr=function(t){return _r(t)?jr(t,!0):gr(t)},mr=de,Or=wr;var Ar=function(t,e){return t&&mr(e,Or(e),t)},Sr={};!function(t,e){var r=z,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,u=o&&o.exports===n?r.Buffer:void 0,a=u?u.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=a?a(r):new t.constructor(r);return t.copy(n),n}}({get exports(){return Sr},set exports(t){Sr=t}},Sr);var kr=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e};var Pr=function(){return[]},xr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,u=[];++r<n;){var a=t[r];e(a,r,t)&&(u[o++]=a)}return u},zr=Pr,Er=Object.prototype.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,Fr=Br?function(t){return null==t?[]:(t=Object(t),xr(Br(t),(function(e){return Er.call(t,e)})))}:zr,Mr=de,Ir=Fr;var Ur=function(t,e){return Mr(t,Ir(t),e)};var Nr=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Cr=Ye(Object.getPrototypeOf,Object),Dr=Nr,Tr=Cr,$r=Fr,Gr=Pr,Rr=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Dr(e,$r(t)),t=Tr(t);return e}:Gr,Lr=de,Vr=Rr;var qr=function(t,e){return Lr(t,Vr(t),e)},Wr=Nr,Hr=Se;var Jr=function(t,e,r){var n=e(t);return Hr(t)?n:Wr(n,r(t))},Kr=Jr,Qr=Fr,Xr=lr;var Yr=function(t){return Kr(t,Xr,Qr)},Zr=Jr,tn=Rr,en=wr;var rn=function(t){return Zr(t,en,tn)},nn=lt(z,"DataView"),on=st,un=lt(z,"Promise"),an=lt(z,"Set"),cn=lt(z,"WeakMap"),fn=G,ln=X,sn="[object Map]",vn="[object Promise]",dn="[object Set]",pn="[object WeakMap]",bn="[object DataView]",yn=ln(nn),hn=ln(on),jn=ln(un),gn=ln(an),_n=ln(cn),wn=fn;(nn&&wn(new nn(new ArrayBuffer(1)))!=bn||on&&wn(new on)!=sn||un&&wn(un.resolve())!=vn||an&&wn(new an)!=dn||cn&&wn(new cn)!=pn)&&(wn=function(t){var e=fn(t),r="[object Object]"==e?t.constructor:void 0,n=r?ln(r):"";if(n)switch(n){case yn:return bn;case hn:return sn;case jn:return vn;case gn:return dn;case _n:return pn}return e});var mn=wn,On=Object.prototype.hasOwnProperty;var An=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&On.call(t,"index")&&(r.index=t.index,r.input=t.input),r},Sn=z.Uint8Array,kn=Sn;var Pn=function(t){var e=new t.constructor(t.byteLength);return new kn(e).set(new kn(t)),e},xn=Pn;var zn=function(t,e){var r=e?xn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)},En=/\w*$/;var Bn=function(t){var e=new t.constructor(t.source,En.exec(t));return e.lastIndex=t.lastIndex,e},Fn=E?E.prototype:void 0,Mn=Fn?Fn.valueOf:void 0;var In=Pn;var Un=Pn,Nn=zn,Cn=Bn,Dn=function(t){return Mn?Object(Mn.call(t)):{}},Tn=function(t,e){var r=e?In(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)};var $n=function(t,e,r){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return Un(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return Nn(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Tn(t,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return Cn(t);case"[object Symbol]":return Dn(t)}},Gn=R,Rn=Object.create,Ln=function(){function t(){}return function(e){if(!Gn(e))return{};if(Rn)return Rn(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Vn=Cr,qn=Xe;var Wn=function(t){return"function"!=typeof t.constructor||qn(t)?{}:Ln(Vn(t))},Hn=mn,Jn=be;var Kn=function(t){return Jn(t)&&"[object Map]"==Hn(t)},Qn=Ne,Xn=Ce&&Ce.isMap,Yn=Xn?Qn(Xn):Kn,Zn=mn,to=be;var eo=function(t){return to(t)&&"[object Set]"==Zn(t)},ro=Ne,no=Ce&&Ce.isSet,oo=no?ro(no):eo,uo=ee,ao=re,io=le,co=dr,fo=Ar,lo=Sr,so=kr,vo=Ur,po=qr,bo=Yr,yo=rn,ho=mn,jo=An,go=$n,_o=Wn,wo=Se,mo=ke,Oo=Yn,Ao=R,So=oo,ko=lr,Po=wr,xo="[object Arguments]",zo="[object Function]",Eo="[object Object]",Bo={};Bo[xo]=Bo["[object Array]"]=Bo["[object ArrayBuffer]"]=Bo["[object DataView]"]=Bo["[object Boolean]"]=Bo["[object Date]"]=Bo["[object Float32Array]"]=Bo["[object Float64Array]"]=Bo["[object Int8Array]"]=Bo["[object Int16Array]"]=Bo["[object Int32Array]"]=Bo["[object Map]"]=Bo["[object Number]"]=Bo[Eo]=Bo["[object RegExp]"]=Bo["[object Set]"]=Bo["[object String]"]=Bo["[object Symbol]"]=Bo["[object Uint8Array]"]=Bo["[object Uint8ClampedArray]"]=Bo["[object Uint16Array]"]=Bo["[object Uint32Array]"]=!0,Bo["[object Error]"]=Bo[zo]=Bo["[object WeakMap]"]=!1;var Fo=function t(e,r,n,o,u,a){var i,c=1&r,f=2&r,l=4&r;if(n&&(i=u?n(e,o,u,a):n(e)),void 0!==i)return i;if(!Ao(e))return e;var s=wo(e);if(s){if(i=jo(e),!c)return so(e,i)}else{var v=ho(e),d=v==zo||"[object GeneratorFunction]"==v;if(mo(e))return lo(e,c);if(v==Eo||v==xo||d&&!u){if(i=f||d?{}:_o(e),!c)return f?po(e,fo(i,e)):vo(e,co(i,e))}else{if(!Bo[v])return u?e:{};i=go(e,v,c)}}a||(a=new uo);var p=a.get(e);if(p)return p;a.set(e,i),So(e)?e.forEach((function(o){i.add(t(o,r,n,o,e,a))})):Oo(e)&&e.forEach((function(o,u){i.set(u,t(o,r,n,u,e,a))}));var b=s?void 0:(l?f?yo:bo:f?Po:ko)(e);return ao(b||e,(function(o,u){b&&(o=e[u=o]),io(i,u,t(o,r,n,u,e,a))})),i},Mo=Fo;var Io=function(t){return Mo(t,5)},Uo=G,No=be;var Co=function(t){return"symbol"==typeof t||No(t)&&"[object Symbol]"==Uo(t)},Do=Se,To=Co,$o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Go=/^\w*$/;var Ro=function(t,e){if(Do(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!To(t))||(Go.test(t)||!$o.test(t)||null!=e&&t in Object(e))},Lo=Vt;function Vo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],u=r.cache;if(u.has(o))return u.get(o);var a=t.apply(this,n);return r.cache=u.set(o,a)||u,a};return r.cache=new(Vo.Cache||Lo),r}Vo.Cache=Lo;var qo=Vo;var Wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ho=/\\(\\)?/g,Jo=function(t){var e=qo(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Wo,(function(t,r,n,o){e.push(n?o.replace(Ho,"$1"):r||t)})),e}));var Ko=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Qo=Ko,Xo=Se,Yo=Co,Zo=E?E.prototype:void 0,tu=Zo?Zo.toString:void 0;var eu=function t(e){if("string"==typeof e)return e;if(Xo(e))return Qo(e,t)+"";if(Yo(e))return tu?tu.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r},ru=eu;var nu=function(t){return null==t?"":ru(t)},ou=Se,uu=Ro,au=Jo,iu=nu;var cu=function(t,e){return ou(t)?t:uu(t,e)?[t]:au(iu(t))},fu=Co;var lu=function(t){if("string"==typeof t||fu(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},su=cu,vu=lu;var du=function(t,e){for(var r=0,n=(e=su(e,t)).length;null!=t&&r<n;)t=t[vu(e[r++])];return r&&r==n?t:void 0},pu=du;var bu=function(t,e,r){var n=null==t?void 0:pu(t,e);return void 0===n?r:n};var yu=Vt,hu=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ju=function(t){return this.__data__.has(t)};function gu(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new yu;++e<r;)this.add(t[e])}gu.prototype.add=gu.prototype.push=hu,gu.prototype.has=ju;var _u=gu,wu=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},mu=function(t,e){return t.has(e)};var Ou=function(t,e,r,n,o,u){var a=1&r,i=t.length,c=e.length;if(i!=c&&!(a&&c>i))return!1;var f=u.get(t),l=u.get(e);if(f&&l)return f==e&&l==t;var s=-1,v=!0,d=2&r?new _u:void 0;for(u.set(t,e),u.set(e,t);++s<i;){var p=t[s],b=e[s];if(n)var y=a?n(b,p,s,e,t,u):n(p,b,s,t,e,u);if(void 0!==y){if(y)continue;v=!1;break}if(d){if(!wu(e,(function(t,e){if(!mu(d,e)&&(p===t||o(p,t,r,n,u)))return d.push(e)}))){v=!1;break}}else if(p!==b&&!o(p,b,r,n,u)){v=!1;break}}return u.delete(t),u.delete(e),v};var Au=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Su=Sn,ku=a,Pu=Ou,xu=Au,zu=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Eu=E?E.prototype:void 0,Bu=Eu?Eu.valueOf:void 0;var Fu=function(t,e,r,n,o,u,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!u(new Su(t),new Su(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ku(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var i=xu;case"[object Set]":var c=1&n;if(i||(i=zu),t.size!=e.size&&!c)return!1;var f=a.get(t);if(f)return f==e;n|=2,a.set(t,e);var l=Pu(i(t),i(e),n,o,u,a);return a.delete(t),l;case"[object Symbol]":if(Bu)return Bu.call(t)==Bu.call(e)}return!1},Mu=Yr,Iu=Object.prototype.hasOwnProperty;var Uu=ee,Nu=Ou,Cu=Fu,Du=function(t,e,r,n,o,u){var a=1&r,i=Mu(t),c=i.length;if(c!=Mu(e).length&&!a)return!1;for(var f=c;f--;){var l=i[f];if(!(a?l in e:Iu.call(e,l)))return!1}var s=u.get(t),v=u.get(e);if(s&&v)return s==e&&v==t;var d=!0;u.set(t,e),u.set(e,t);for(var p=a;++f<c;){var b=t[l=i[f]],y=e[l];if(n)var h=a?n(y,b,l,e,t,u):n(b,y,l,t,e,u);if(!(void 0===h?b===y||o(b,y,r,n,u):h)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var j=t.constructor,g=e.constructor;j==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof j&&j instanceof j&&"function"==typeof g&&g instanceof g||(d=!1)}return u.delete(t),u.delete(e),d},Tu=mn,$u=Se,Gu=ke,Ru=Ge,Lu="[object Arguments]",Vu="[object Array]",qu="[object Object]",Wu=Object.prototype.hasOwnProperty;var Hu=function(t,e,r,n,o,u){var a=$u(t),i=$u(e),c=a?Vu:Tu(t),f=i?Vu:Tu(e),l=(c=c==Lu?qu:c)==qu,s=(f=f==Lu?qu:f)==qu,v=c==f;if(v&&Gu(t)){if(!Gu(e))return!1;a=!0,l=!1}if(v&&!l)return u||(u=new Uu),a||Ru(t)?Nu(t,e,r,n,o,u):Cu(t,e,c,r,n,o,u);if(!(1&r)){var d=l&&Wu.call(t,"__wrapped__"),p=s&&Wu.call(e,"__wrapped__");if(d||p){var b=d?t.value():t,y=p?e.value():e;return u||(u=new Uu),o(b,y,r,n,u)}}return!!v&&(u||(u=new Uu),Du(t,e,r,n,o,u))},Ju=be;var Ku=function t(e,r,n,o,u){return e===r||(null==e||null==r||!Ju(e)&&!Ju(r)?e!=e&&r!=r:Hu(e,r,n,o,t,u))},Qu=ee,Xu=Ku;var Yu=R;var Zu=function(t){return t==t&&!Yu(t)},ta=Zu,ea=lr;var ra=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}},na=function(t,e,r,n){var o=r.length,u=o,a=!n;if(null==t)return!u;for(t=Object(t);o--;){var i=r[o];if(a&&i[2]?i[1]!==t[i[0]]:!(i[0]in t))return!1}for(;++o<u;){var c=(i=r[o])[0],f=t[c],l=i[1];if(a&&i[2]){if(void 0===f&&!(c in t))return!1}else{var s=new Qu;if(n)var v=n(f,l,c,t,e,s);if(!(void 0===v?Xu(l,f,3,n,s):v))return!1}}return!0},oa=function(t){for(var e=ea(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,ta(o)]}return e},ua=ra;var aa=cu,ia=Ae,ca=Se,fa=ze,la=Ee,sa=lu;var va=function(t,e){return null!=t&&e in Object(t)},da=function(t,e,r){for(var n=-1,o=(e=aa(e,t)).length,u=!1;++n<o;){var a=sa(e[n]);if(!(u=null!=t&&r(t,a)))break;t=t[a]}return u||++n!=o?u:!!(o=null==t?0:t.length)&&la(o)&&fa(a,o)&&(ca(t)||ia(t))};var pa=Ku,ba=bu,ya=function(t,e){return null!=t&&da(t,e,va)},ha=Ro,ja=Zu,ga=ra,_a=lu;var wa=function(t){return t};var ma=function(t){return function(e){return null==e?void 0:e[t]}},Oa=du;var Aa=ma,Sa=function(t){return function(e){return Oa(e,t)}},ka=Ro,Pa=lu;var xa=function(t){var e=oa(t);return 1==e.length&&e[0][2]?ua(e[0][0],e[0][1]):function(r){return r===t||na(r,t,e)}},za=function(t,e){return ha(t)&&ja(e)?ga(_a(t),e):function(r){var n=ba(r,t);return void 0===n&&n===e?ya(r,t):pa(e,n,3)}},Ea=wa,Ba=Se,Fa=function(t){return ka(t)?Aa(Pa(t)):Sa(t)};var Ma=function(t){return"function"==typeof t?t:null==t?Ea:"object"==typeof t?Ba(t)?za(t[0],t[1]):xa(t):Fa(t)};var Ia=function(t){return function(e,r,n){for(var o=-1,u=Object(e),a=n(e),i=a.length;i--;){var c=a[t?i:++o];if(!1===r(u[c],c,u))break}return e}}(),Ua=lr;var Na=ar;var Ca=function(t,e){return function(r,n){if(null==r)return r;if(!Na(r))return t(r,n);for(var o=r.length,u=e?o:-1,a=Object(r);(e?u--:++u<o)&&!1!==n(a[u],u,a););return r}}((function(t,e){return t&&Ia(t,e,Ua)})),Da=Ca,Ta=ar;var $a=Ko,Ga=Ma,Ra=function(t,e){var r=-1,n=Ta(t)?Array(t.length):[];return Da(t,(function(t,o,u){n[++r]=e(t,o,u)})),n},La=Se;var Va=function(t,e){return(La(t)?$a:Ra)(t,Ga(e))};var qa=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var u=Array(o);++n<o;)u[n]=t[n+e];return u},Wa=du,Ha=qa;var Ja=cu,Ka=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},Qa=function(t,e){return e.length<2?t:Wa(t,Ha(e,0,-1))},Xa=lu;var Ya=function(t,e){return e=Ja(e,t),null==(t=Qa(t,e))||delete t[Xa(Ka(e))]},Za=G,ti=Cr,ei=be,ri=Function.prototype,ni=Object.prototype,oi=ri.toString,ui=ni.hasOwnProperty,ai=oi.call(Object);var ii=function(t){if(!ei(t)||"[object Object]"!=Za(t))return!1;var e=ti(t);if(null===e)return!0;var r=ui.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&oi.call(r)==ai};var ci=function(t){return ii(t)?void 0:t},fi=Ae,li=Se,si=E?E.isConcatSpreadable:void 0;var vi=Nr,di=function(t){return li(t)||fi(t)||!!(si&&t&&t[si])};var pi=function t(e,r,n,o,u){var a=-1,i=e.length;for(n||(n=di),u||(u=[]);++a<i;){var c=e[a];r>0&&n(c)?r>1?t(c,r-1,n,o,u):vi(u,c):o||(u[u.length]=c)}return u},bi=pi;var yi=function(t){return(null==t?0:t.length)?bi(t,1):[]};var hi=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},ji=Math.max;var gi=function(t,e,r){return e=ji(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,u=ji(n.length-e,0),a=Array(u);++o<u;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),hi(t,this,i)}};var _i=function(t){return function(){return t}},wi=oe,mi=wi?function(t,e){return wi(t,"toString",{configurable:!0,enumerable:!1,value:_i(e),writable:!0})}:wa,Oi=Date.now;var Ai=function(t){var e=0,r=0;return function(){var n=Oi(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},Si=Ai(mi),ki=yi,Pi=gi,xi=Si;var zi=Ko,Ei=Fo,Bi=Ya,Fi=cu,Mi=de,Ii=ci,Ui=rn,Ni=function(t){return xi(Pi(t,void 0,ki),t+"")}((function(t,e){var r={};if(null==t)return r;var n=!1;e=zi(e,(function(e){return e=Fi(e,t),n||(n=e.length>1),e})),Mi(t,Ui(t),r),n&&(r=Ei(r,7,Ii));for(var o=e.length;o--;)Bi(r,e[o]);return r})),Ci=G,Di=Se,Ti=be;var $i=function(t){return"string"==typeof t||!Di(t)&&Ti(t)&&"[object String]"==Ci(t)},Gi=ma("length"),Ri=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Li=function(t){return Ri.test(t)},Vi="\\ud800-\\udfff",qi="["+Vi+"]",Wi="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Hi="\\ud83c[\\udffb-\\udfff]",Ji="[^"+Vi+"]",Ki="(?:\\ud83c[\\udde6-\\uddff]){2}",Qi="[\\ud800-\\udbff][\\udc00-\\udfff]",Xi="(?:"+Wi+"|"+Hi+")"+"?",Yi="[\\ufe0e\\ufe0f]?",Zi=Yi+Xi+("(?:\\u200d(?:"+[Ji,Ki,Qi].join("|")+")"+Yi+Xi+")*"),tc="(?:"+[Ji+Wi+"?",Wi,Ki,Qi,qi].join("|")+")",ec=RegExp(Hi+"(?="+Hi+")|"+tc+Zi,"g");var rc=Gi,nc=Li,oc=function(t){for(var e=ec.lastIndex=0;ec.test(t);)++e;return e};var uc=nr,ac=mn,ic=ar,cc=$i,fc=function(t){return nc(t)?oc(t):rc(t)};var lc=function(t){if(null==t)return 0;if(ic(t))return cc(t)?fc(t):t.length;var e=ac(t);return"[object Map]"==e||"[object Set]"==e?t.size:uc(t).length};function sc(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}var vc=/\s/;var dc=function(t){for(var e=t.length;e--&&vc.test(t.charAt(e)););return e},pc=/^\s+/;var bc=function(t){return t?t.slice(0,dc(t)+1).replace(pc,""):t},yc=R,hc=Co,jc=/^[-+]0x[0-9a-f]+$/i,gc=/^0b[01]+$/i,_c=/^0o[0-7]+$/i,wc=parseInt;var mc=function(t){if("number"==typeof t)return t;if(hc(t))return NaN;if(yc(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=yc(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=bc(t);var r=gc.test(t);return r||_c.test(t)?wc(t.slice(2),r?2:8):jc.test(t)?NaN:+t},Oc=mc,Ac=1/0;var Sc=function(t){return t?(t=Oc(t))===Ac||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},kc=Sc;var Pc=function(t){var e=kc(t),r=e%1;return e==e?r?e-r:e:0},xc=Pc;var zc=function(t){return"number"==typeof t&&t==xc(t)};function Ec(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}function Bc(t){let e=!1;return Ec(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function Fc(t){if(!Bc(t))return 0;return Sc(t)}var Mc=Pc,Ic=mc,Uc=nu,Nc=z.isFinite,Cc=Math.min;var Dc=function(t){var e=Math[t];return function(t,r){if(t=Ic(t),(r=null==r?0:Cc(Mc(r),292))&&Nc(t)){var n=(Uc(t)+"e").split("e"),o=e(n[0]+"e"+(+n[1]+r));return+((n=(Uc(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");function Tc(t){if(!Bc(t))return 0;t=Fc(t);let e=Dc(t);return"0"===String(e)?0:e}function $c(t){if(!function(t){return!!Bc(t)&&(t=Fc(t),zc(t))}(t))return!1;return Tc(t)>0}let Gc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Rc=Gc.length;function Lc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=$c(t)?Tc(t):32;for(let r=0;r<t;r++)e[r]=Gc[0|Math.random()*Rc];return e.join("")}function Vc(t){return"[object Array]"===Object.prototype.toString.call(t)}var qc=qa,Wc=Pc;var Hc=function(t,e,r){var n=null==t?0:t.length;return n?(e=r||void 0===e?1:Wc(e),qc(t,e<0?0:e,n)):[]},Jc={},Kc=wa;var Qc=re,Xc=Ca,Yc=function(t){return"function"==typeof t?t:Kc},Zc=Se;var tf=function(t,e){return(Zc(t)?Qc:Xc)(t,Yc(e))};!function(t){t.exports=tf}({get exports(){return Jc},set exports(t){Jc=t}});var ef=o(Jc);function rf(t){return"[object Object]"===Object.prototype.toString.call(t)}function nf(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function of(t,e){let r=sc();if(!Vc(t)&&!rf(t))return r.reject("rs is not an array or object"),r;let n=!1;if(rf(t)){n=!0;let e=[];ef(t,((t,r)=>{e.push({k:r,v:t})})),t=e}nf(e)||(e=function(t){return t});let o=-1,u=[];return t.reduce((function(t,r){return t.then((function(t){u.push(t),o+=1;let a=o,i=r;return n&&(a=r.k,i=r.v),nf(e)?e(i,a):i}))}),Promise.resolve()).then((function(t){u.push(t),u=Hc(u),r.resolve(u)})).catch((function(t){r.reject(t)})),r}let uf={useNewUrlParser:!0,useUnifiedTopology:!0};return function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.url||(n.url="mongodb://127.0.0.1:27017"),n.db||(n.db="worm"),n.cl||(n.cl="test");let o=new t.EventEmitter,u=e.MongoClient;async function a(t){let e=!1;t=Io(t);let r=new u(n.url,uf),a=null;try{let u=r.db(n.db).collection(n.cl);Vc(t)||(t=[t]),t=Va(t,(function(t){return t.id||(t.id=Lc()),t})),a=await u.insertMany(t),a.insertedCount>0?(a={n:lc(t),nInserted:a.insertedCount,ok:a.acknowledged?1:0},o.emit("change","insert",t,a)):(e=!0,a="no insert data")}catch(t){e=!0,a=t}finally{await r.close()}return e?Promise.reject(a):a}async function i(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,r=!1,n=null;try{let r=e.find(t);n=await r.toArray()}catch(t){r=!0,n=t}return r?Promise.reject(n):n}return o.select=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=!1,r=new u(n.url,uf),o=null;try{let e=r.db(n.db).collection(n.cl).find(t);o=await e.toArray(),o=Va(o,(function(t){return t=Ni(t,"_id")}))}catch(t){e=!0,o=t}finally{await r.close()}return e?Promise.reject(o):o},o.insert=a,o.save=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!1;t=Io(t);let i=bu(e,"autoInsert",!0),c=bu(e,"atomic",!1),f=new u(n.url,uf),l=null;try{let e=f.db(n.db).collection(n.cl);Vc(t)||(t=[t]);let r=null;r=c?"findOneAndUpdate":"updateOne",l=await of(t,(async t=>{let n=null;return n=await e[r]({id:t.id},{$set:t}),n=n.lastErrorObject?{n:n.lastErrorObject.n,nModified:n.lastErrorObject.updatedExisting?1:0,ok:1}:{n:n.matchedCount,nModified:n.modifiedCount,ok:n.acknowledged?1:0},i&&0===n.n&&(n=await a(t)),n})),o.emit("change","save",t,l)}catch(t){r=!0,l=t}finally{await f.close()}return r?Promise.reject(l):l},o.del=async function(t){let e=!1;t=Io(t);let r=new u(n.url,uf),a=null;try{let e=r.db(n.db).collection(n.cl);Vc(t)||(t=[t]),a=await of(t,(async t=>{let r=null;return r=await e.deleteOne({id:t.id}),r={n:r.deletedCount,nDeleted:r.deletedCount,ok:r.acknowledged?1:0},r})),o.emit("change","del",t,a)}catch(t){e=!0,a=t}finally{await r.close()}return e?Promise.reject(a):a},o.delAll=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=!1,r=new u(n.url,uf),a=null;try{let e=r.db(n.db).collection(n.cl);a=await e.deleteMany(t),a={n:a.deletedCount,nDeleted:a.deletedCount,ok:a.acknowledged?1:0},o.emit("change","delAll",null,a)}catch(t){e=!0,a=t}finally{await r.close()}return e?Promise.reject(a):a},o.selectGfs=async function(t){let r=!1,o=new u(n.url,uf),a=null;try{a=await(async t=>{let r=sc(),u=o.db(n.db),a=new e.GridFSBucket(u,{chunkSizeBytes:10485760,bucketName:n.cl}),i=Buffer.from(""),c=a.openDownloadStreamByName(t);return c.on("data",(function(t){i=Buffer.concat([i,t])})),c.on("error",(function(t){r.reject(t)})),c.on("end",(function(){let t=new Uint8Array(i);i=null,r.resolve(t)})),r})(t)}catch(t){r=!0,a=t}finally{await o.close()}return r?Promise.reject(a):a},o.insertGfs=async function(t){let a=!1,i=Lc(),c=Buffer.from(t),f=new u(n.url,uf),l=null;try{l=await(async(t,o)=>{let u=sc(),a=f.db(n.db),i=new e.GridFSBucket(a,{chunkSizeBytes:10485760,bucketName:n.cl}),c=new r.Readable;return c._read=()=>{},c.push(o),c.push(null),c.pipe(i.openUploadStream(t)).on("error",(function(t){u.reject(t)})).on("finish",(function(){let e={n:1,ok:1,id:t};u.resolve(e)})),u})(i,c),o.emit("change","insertGfs",null,l)}catch(t){a=!0,l=t}finally{await f.close()}return a?Promise.reject(l):l},o.delGfs=async function(t){let r=!1,a=new u(n.url,uf),c=null;try{let r=a.db(n.db),u=new e.GridFSBucket(r,{chunkSizeBytes:10485760,bucketName:n.cl});if(c=await i({filename:t},u),0===c.length)c=`can not find id[${t}]`;else if(c.length>1)c=`duplicate id[${t}]`;else{let t=c[0]._id;c=await u.delete(t),c={n:1,nDeleted:1,ok:1},o.emit("change","delGfs",null,c)}}catch(t){r=!0,c=t}finally{await a.close()}return r?Promise.reject(c):c},o.delAllGfs=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1,a=new u(n.url,uf),c=null;try{let r=a.db(n.db),u=new e.GridFSBucket(r,{chunkSizeBytes:10485760,bucketName:n.cl});c=await i(t,u);let f=lc(c),l=Va(c,(function(t){return async function(t,e){let r=!1,n=null;try{n=await e.delete(t),n={n:1,nDeleted:1,ok:1}}catch(t){r=!0,n=t}return r?Promise.reject(n):n}(t._id,u)}));c=await Promise.all(l),c={n:f,ok:1},o.emit("change","delAllGfs",null,c)}catch(t){r=!0,c=t}finally{await a.close()}return r?Promise.reject(c):c},o}}));
//# sourceMappingURL=w-orm-mongodb.umd.js.map
