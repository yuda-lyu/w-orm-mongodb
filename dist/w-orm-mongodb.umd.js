/*!
 * w-orm-mongodb v1.1.14
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["events","mongodb","stream"],r):(t=t||self)["w-orm-mongodb"]=r(t.events,t.mongodb,t.stream)}(this,(function(t,r,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,e=e&&e.hasOwnProperty("default")?e.default:e;var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(t,r){return t(r={exports:{}},r.exports),r.exports}var a=u((function(t){var r=function(t){var r,e=Object.prototype,o=e.hasOwnProperty,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.asyncIterator||"@@asyncIterator",c=u.toStringTag||"@@toStringTag";function f(t,r,e,n){var o=r&&r.prototype instanceof y?r:y,u=Object.create(o.prototype),a=new E(n||[]);return u._invoke=function(t,r,e){var n=l;return function(o,u){if(n===p)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw u;return L()}for(e.method=o,e.arg=u;;){var a=e.delegate;if(a){var i=A(a,e);if(i){if(i===d)continue;return i}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(n===l)throw n=h,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n=p;var c=s(t,r,e);if("normal"===c.type){if(n=e.done?h:v,c.arg===d)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n=h,e.method="throw",e.arg=c.arg)}}}(t,e,a),u}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var l="suspendedStart",v="suspendedYield",p="executing",h="completed",d={};function y(){}function b(){}function g(){}var j={};j[a]=function(){return this};var w=Object.getPrototypeOf,m=w&&w(w(P([])));m&&m!==e&&o.call(m,a)&&(j=m);var _=g.prototype=y.prototype=Object.create(j);function O(t){["next","throw","return"].forEach((function(r){t[r]=function(t){return this._invoke(r,t)}}))}function x(t){var r;this._invoke=function(e,u){function a(){return new Promise((function(r,a){!function r(e,u,a,i){var c=s(t[e],t,u);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"===n(l)&&o.call(l,"__await")?Promise.resolve(l.__await).then((function(t){r("next",t,a,i)}),(function(t){r("throw",t,a,i)})):Promise.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,i)}))}i(c.arg)}(e,u,r,a)}))}return r=r?r.then(a,a):a()}}function A(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,A(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,d;var u=o.arg;return u?u.done?(e[t.resultName]=u.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):u:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function k(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,u=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return u.next=u}}return{next:L}}function L(){return{value:r,done:!0}}return b.prototype=_.constructor=g,g.constructor=b,g[c]=b.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===b||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},O(x.prototype),x.prototype[i]=function(){return this},t.AsyncIterator=x,t.async=function(r,e,n,o){var u=new x(f(r,e,n,o));return t.isGeneratorFunction(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},O(_),_[c]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return i.type="throw",i.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var u=this.tryEntries.length-1;u>=0;--u){var a=this.tryEntries[u],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),f=o.call(a,"finallyLoc");if(c&&f){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var u=n;break}}u&&("break"===t||"continue"===t)&&u.tryLoc<=r&&r<=u.finallyLoc&&(u=null);var a=u?u.completion:{};return a.type=t,a.arg=r,u?(this.method="next",this.next=u.finallyLoc,d):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),d},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),k(e),d}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;k(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}}));function i(t,r,e,n,o,u,a){try{var i=t[u](a),c=i.value}catch(t){return void e(t)}i.done?r(c):Promise.resolve(c).then(n,o)}var c=function(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var u=t.apply(r,e);function a(t){i(u,n,o,a,c,"next",t)}function c(t){i(u,n,o,a,c,"throw",t)}a(void 0)}))}};var f=function(){this.__data__=[],this.size=0};var s=function(t,r){return t===r||t!=t&&r!=r};var l=function(t,r){for(var e=t.length;e--;)if(s(t[e][0],r))return e;return-1},v=Array.prototype.splice;var p=function(t){var r=this.__data__,e=l(r,t);return!(e<0)&&(e==r.length-1?r.pop():v.call(r,e,1),--this.size,!0)};var h=function(t){var r=this.__data__,e=l(r,t);return e<0?void 0:r[e][1]};var d=function(t){return l(this.__data__,t)>-1};var y=function(t,r){var e=this.__data__,n=l(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function b(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}b.prototype.clear=f,b.prototype.delete=p,b.prototype.get=h,b.prototype.has=d,b.prototype.set=y;var g=b;var j=function(){this.__data__=new g,this.size=0};var w=function(t){var r=this.__data__,e=r.delete(t);return this.size=r.size,e};var m=function(t){return this.__data__.get(t)};var _=function(t){return this.__data__.has(t)},O="object"==n(o)&&o&&o.Object===Object&&o,x="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,A=O||x||Function("return this")(),S=A.Symbol,k=Object.prototype,E=k.hasOwnProperty,P=k.toString,L=S?S.toStringTag:void 0;var z=function(t){var r=E.call(t,L),e=t[L];try{t[L]=void 0;var n=!0}catch(t){}var o=P.call(t);return n&&(r?t[L]=e:delete t[L]),o},F=Object.prototype.toString;var B=function(t){return F.call(t)},N="[object Null]",M="[object Undefined]",G=S?S.toStringTag:void 0;var I=function(t){return null==t?void 0===t?M:N:G&&G in Object(t)?z(t):B(t)};var U=function(t){var r=n(t);return null!=t&&("object"==r||"function"==r)},T="[object AsyncFunction]",D="[object Function]",$="[object GeneratorFunction]",R="[object Proxy]";var C,V=function(t){if(!U(t))return!1;var r=I(t);return r==D||r==$||r==T||r==R},q=A["__core-js_shared__"],W=(C=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"";var Y=function(t){return!!W&&W in t},H=Function.prototype.toString;var J=function(t){if(null!=t){try{return H.call(t)}catch(t){}try{return t+""}catch(t){}}return""},K=/^\[object .+?Constructor\]$/,Q=Function.prototype,X=Object.prototype,Z=Q.toString,tt=X.hasOwnProperty,rt=RegExp("^"+Z.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var et=function(t){return!(!U(t)||Y(t))&&(V(t)?rt:K).test(J(t))};var nt=function(t,r){return null==t?void 0:t[r]};var ot=function(t,r){var e=nt(t,r);return et(e)?e:void 0},ut=ot(A,"Map"),at=ot(Object,"create");var it=function(){this.__data__=at?at(null):{},this.size=0};var ct=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},ft="__lodash_hash_undefined__",st=Object.prototype.hasOwnProperty;var lt=function(t){var r=this.__data__;if(at){var e=r[t];return e===ft?void 0:e}return st.call(r,t)?r[t]:void 0},vt=Object.prototype.hasOwnProperty;var pt=function(t){var r=this.__data__;return at?void 0!==r[t]:vt.call(r,t)},ht="__lodash_hash_undefined__";var dt=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=at&&void 0===r?ht:r,this};function yt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}yt.prototype.clear=it,yt.prototype.delete=ct,yt.prototype.get=lt,yt.prototype.has=pt,yt.prototype.set=dt;var bt=yt;var gt=function(){this.size=0,this.__data__={hash:new bt,map:new(ut||g),string:new bt}};var jt=function(t){var r=n(t);return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var wt=function(t,r){var e=t.__data__;return jt(r)?e["string"==typeof r?"string":"hash"]:e.map};var mt=function(t){var r=wt(this,t).delete(t);return this.size-=r?1:0,r};var _t=function(t){return wt(this,t).get(t)};var Ot=function(t){return wt(this,t).has(t)};var xt=function(t,r){var e=wt(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function At(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}At.prototype.clear=gt,At.prototype.delete=mt,At.prototype.get=_t,At.prototype.has=Ot,At.prototype.set=xt;var St=At,kt=200;var Et=function(t,r){var e=this.__data__;if(e instanceof g){var n=e.__data__;if(!ut||n.length<kt-1)return n.push([t,r]),this.size=++e.size,this;e=this.__data__=new St(n)}return e.set(t,r),this.size=e.size,this};function Pt(t){var r=this.__data__=new g(t);this.size=r.size}Pt.prototype.clear=j,Pt.prototype.delete=w,Pt.prototype.get=m,Pt.prototype.has=_,Pt.prototype.set=Et;var Lt=Pt;var zt=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t},Ft=function(){try{var t=ot(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Bt=function(t,r,e){"__proto__"==r&&Ft?Ft(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},Nt=Object.prototype.hasOwnProperty;var Mt=function(t,r,e){var n=t[r];Nt.call(t,r)&&s(n,e)&&(void 0!==e||r in t)||Bt(t,r,e)};var Gt=function(t,r,e,n){var o=!e;e||(e={});for(var u=-1,a=r.length;++u<a;){var i=r[u],c=n?n(e[i],t[i],i,e,t):void 0;void 0===c&&(c=t[i]),o?Bt(e,i,c):Mt(e,i,c)}return e};var It=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n};var Ut=function(t){return null!=t&&"object"==n(t)},Tt="[object Arguments]";var Dt=function(t){return Ut(t)&&I(t)==Tt},$t=Object.prototype,Rt=$t.hasOwnProperty,Ct=$t.propertyIsEnumerable,Vt=Dt(function(){return arguments}())?Dt:function(t){return Ut(t)&&Rt.call(t,"callee")&&!Ct.call(t,"callee")},qt=Array.isArray;var Wt=function(){return!1},Yt=u((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?A.Buffer:void 0,u=(o?o.isBuffer:void 0)||Wt;t.exports=u})),Ht=9007199254740991,Jt=/^(?:0|[1-9]\d*)$/;var Kt=function(t,r){var e=n(t);return!!(r=null==r?Ht:r)&&("number"==e||"symbol"!=e&&Jt.test(t))&&t>-1&&t%1==0&&t<r},Qt=9007199254740991;var Xt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Qt},Zt={};Zt["[object Float32Array]"]=Zt["[object Float64Array]"]=Zt["[object Int8Array]"]=Zt["[object Int16Array]"]=Zt["[object Int32Array]"]=Zt["[object Uint8Array]"]=Zt["[object Uint8ClampedArray]"]=Zt["[object Uint16Array]"]=Zt["[object Uint32Array]"]=!0,Zt["[object Arguments]"]=Zt["[object Array]"]=Zt["[object ArrayBuffer]"]=Zt["[object Boolean]"]=Zt["[object DataView]"]=Zt["[object Date]"]=Zt["[object Error]"]=Zt["[object Function]"]=Zt["[object Map]"]=Zt["[object Number]"]=Zt["[object Object]"]=Zt["[object RegExp]"]=Zt["[object Set]"]=Zt["[object String]"]=Zt["[object WeakMap]"]=!1;var tr=function(t){return Ut(t)&&Xt(t.length)&&!!Zt[I(t)]};var rr=function(t){return function(r){return t(r)}},er=u((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&O.process,u=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=u})),nr=er&&er.isTypedArray,or=nr?rr(nr):tr,ur=Object.prototype.hasOwnProperty;var ar=function(t,r){var e=qt(t),n=!e&&Vt(t),o=!e&&!n&&Yt(t),u=!e&&!n&&!o&&or(t),a=e||n||o||u,i=a?It(t.length,String):[],c=i.length;for(var f in t)!r&&!ur.call(t,f)||a&&("length"==f||o&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Kt(f,c))||i.push(f);return i},ir=Object.prototype;var cr=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||ir)};var fr=function(t,r){return function(e){return t(r(e))}},sr=fr(Object.keys,Object),lr=Object.prototype.hasOwnProperty;var vr=function(t){if(!cr(t))return sr(t);var r=[];for(var e in Object(t))lr.call(t,e)&&"constructor"!=e&&r.push(e);return r};var pr=function(t){return null!=t&&Xt(t.length)&&!V(t)};var hr=function(t){return pr(t)?ar(t):vr(t)};var dr=function(t,r){return t&&Gt(r,hr(r),t)};var yr=function(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r},br=Object.prototype.hasOwnProperty;var gr=function(t){if(!U(t))return yr(t);var r=cr(t),e=[];for(var n in t)("constructor"!=n||!r&&br.call(t,n))&&e.push(n);return e};var jr=function(t){return pr(t)?ar(t,!0):gr(t)};var wr=function(t,r){return t&&Gt(r,jr(r),t)},mr=u((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?A.Buffer:void 0,u=o?o.allocUnsafe:void 0;t.exports=function(t,r){if(r)return t.slice();var e=t.length,n=u?u(e):new t.constructor(e);return t.copy(n),n}}));var _r=function(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r};var Or=function(t,r){for(var e=-1,n=null==t?0:t.length,o=0,u=[];++e<n;){var a=t[e];r(a,e,t)&&(u[o++]=a)}return u};var xr=function(){return[]},Ar=Object.prototype.propertyIsEnumerable,Sr=Object.getOwnPropertySymbols,kr=Sr?function(t){return null==t?[]:(t=Object(t),Or(Sr(t),(function(r){return Ar.call(t,r)})))}:xr;var Er=function(t,r){return Gt(t,kr(t),r)};var Pr=function(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t},Lr=fr(Object.getPrototypeOf,Object),zr=Object.getOwnPropertySymbols?function(t){for(var r=[];t;)Pr(r,kr(t)),t=Lr(t);return r}:xr;var Fr=function(t,r){return Gt(t,zr(t),r)};var Br=function(t,r,e){var n=r(t);return qt(t)?n:Pr(n,e(t))};var Nr=function(t){return Br(t,hr,kr)};var Mr=function(t){return Br(t,jr,zr)},Gr=ot(A,"DataView"),Ir=ot(A,"Promise"),Ur=ot(A,"Set"),Tr=ot(A,"WeakMap"),Dr=J(Gr),$r=J(ut),Rr=J(Ir),Cr=J(Ur),Vr=J(Tr),qr=I;(Gr&&"[object DataView]"!=qr(new Gr(new ArrayBuffer(1)))||ut&&"[object Map]"!=qr(new ut)||Ir&&"[object Promise]"!=qr(Ir.resolve())||Ur&&"[object Set]"!=qr(new Ur)||Tr&&"[object WeakMap]"!=qr(new Tr))&&(qr=function(t){var r=I(t),e="[object Object]"==r?t.constructor:void 0,n=e?J(e):"";if(n)switch(n){case Dr:return"[object DataView]";case $r:return"[object Map]";case Rr:return"[object Promise]";case Cr:return"[object Set]";case Vr:return"[object WeakMap]"}return r});var Wr=qr,Yr=Object.prototype.hasOwnProperty;var Hr=function(t){var r=t.length,e=new t.constructor(r);return r&&"string"==typeof t[0]&&Yr.call(t,"index")&&(e.index=t.index,e.input=t.input),e},Jr=A.Uint8Array;var Kr=function(t){var r=new t.constructor(t.byteLength);return new Jr(r).set(new Jr(t)),r};var Qr=function(t,r){var e=r?Kr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)},Xr=/\w*$/;var Zr=function(t){var r=new t.constructor(t.source,Xr.exec(t));return r.lastIndex=t.lastIndex,r},te=S?S.prototype:void 0,re=te?te.valueOf:void 0;var ee=function(t){return re?Object(re.call(t)):{}};var ne=function(t,r){var e=r?Kr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)},oe="[object Boolean]",ue="[object Date]",ae="[object Map]",ie="[object Number]",ce="[object RegExp]",fe="[object Set]",se="[object String]",le="[object Symbol]",ve="[object ArrayBuffer]",pe="[object DataView]",he="[object Float32Array]",de="[object Float64Array]",ye="[object Int8Array]",be="[object Int16Array]",ge="[object Int32Array]",je="[object Uint8Array]",we="[object Uint8ClampedArray]",me="[object Uint16Array]",_e="[object Uint32Array]";var Oe=function(t,r,e){var n=t.constructor;switch(r){case ve:return Kr(t);case oe:case ue:return new n(+t);case pe:return Qr(t,e);case he:case de:case ye:case be:case ge:case je:case we:case me:case _e:return ne(t,e);case ae:return new n;case ie:case se:return new n(t);case ce:return Zr(t);case fe:return new n;case le:return ee(t)}},xe=Object.create,Ae=function(){function t(){}return function(r){if(!U(r))return{};if(xe)return xe(r);t.prototype=r;var e=new t;return t.prototype=void 0,e}}();var Se=function(t){return"function"!=typeof t.constructor||cr(t)?{}:Ae(Lr(t))},ke="[object Map]";var Ee=function(t){return Ut(t)&&Wr(t)==ke},Pe=er&&er.isMap,Le=Pe?rr(Pe):Ee,ze="[object Set]";var Fe=function(t){return Ut(t)&&Wr(t)==ze},Be=er&&er.isSet,Ne=Be?rr(Be):Fe,Me=1,Ge=2,Ie=4,Ue="[object Arguments]",Te="[object Function]",De="[object GeneratorFunction]",$e="[object Object]",Re={};Re[Ue]=Re["[object Array]"]=Re["[object ArrayBuffer]"]=Re["[object DataView]"]=Re["[object Boolean]"]=Re["[object Date]"]=Re["[object Float32Array]"]=Re["[object Float64Array]"]=Re["[object Int8Array]"]=Re["[object Int16Array]"]=Re["[object Int32Array]"]=Re["[object Map]"]=Re["[object Number]"]=Re[$e]=Re["[object RegExp]"]=Re["[object Set]"]=Re["[object String]"]=Re["[object Symbol]"]=Re["[object Uint8Array]"]=Re["[object Uint8ClampedArray]"]=Re["[object Uint16Array]"]=Re["[object Uint32Array]"]=!0,Re["[object Error]"]=Re[Te]=Re["[object WeakMap]"]=!1;var Ce=function t(r,e,n,o,u,a){var i,c=e&Me,f=e&Ge,s=e&Ie;if(n&&(i=u?n(r,o,u,a):n(r)),void 0!==i)return i;if(!U(r))return r;var l=qt(r);if(l){if(i=Hr(r),!c)return _r(r,i)}else{var v=Wr(r),p=v==Te||v==De;if(Yt(r))return mr(r,c);if(v==$e||v==Ue||p&&!u){if(i=f||p?{}:Se(r),!c)return f?Fr(r,wr(i,r)):Er(r,dr(i,r))}else{if(!Re[v])return u?r:{};i=Oe(r,v,c)}}a||(a=new Lt);var h=a.get(r);if(h)return h;a.set(r,i),Ne(r)?r.forEach((function(o){i.add(t(o,e,n,o,r,a))})):Le(r)&&r.forEach((function(o,u){i.set(u,t(o,e,n,u,r,a))}));var d=s?f?Mr:Nr:f?keysIn:hr,y=l?void 0:d(r);return zt(y||r,(function(o,u){y&&(o=r[u=o]),Mt(i,u,t(o,e,n,u,r,a))})),i},Ve=1,qe=4;var We=function(t){return Ce(t,Ve|qe)},Ye="[object Symbol]";var He=function(t){return"symbol"==n(t)||Ut(t)&&I(t)==Ye},Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ke=/^\w*$/;var Qe=function(t,r){if(qt(t))return!1;var e=n(t);return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!He(t))||(Ke.test(t)||!Je.test(t)||null!=r&&t in Object(r))},Xe="Expected a function";function Ze(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError(Xe);var e=function e(){var n=arguments,o=r?r.apply(this,n):n[0],u=e.cache;if(u.has(o))return u.get(o);var a=t.apply(this,n);return e.cache=u.set(o,a)||u,a};return e.cache=new(Ze.Cache||St),e}Ze.Cache=St;var tn=Ze,rn=500;var en=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nn=/\\(\\)?/g,on=function(t){var r=tn(t,(function(t){return e.size===rn&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(en,(function(t,e,n,o){r.push(n?o.replace(nn,"$1"):e||t)})),r}));var un=function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o},an=1/0,cn=S?S.prototype:void 0,fn=cn?cn.toString:void 0;var sn=function t(r){if("string"==typeof r)return r;if(qt(r))return un(r,t)+"";if(He(r))return fn?fn.call(r):"";var e=r+"";return"0"==e&&1/r==-an?"-0":e};var ln=function(t){return null==t?"":sn(t)};var vn=function(t,r){return qt(t)?t:Qe(t,r)?[t]:on(ln(t))},pn=1/0;var hn=function(t){if("string"==typeof t||He(t))return t;var r=t+"";return"0"==r&&1/t==-pn?"-0":r};var dn=function(t,r){for(var e=0,n=(r=vn(r,t)).length;null!=t&&e<n;)t=t[hn(r[e++])];return e&&e==n?t:void 0};var yn=function(t,r,e){var n=null==t?void 0:dn(t,r);return void 0===n?e:n},bn="__lodash_hash_undefined__";var gn=function(t){return this.__data__.set(t,bn),this};var jn=function(t){return this.__data__.has(t)};function wn(t){var r=-1,e=null==t?0:t.length;for(this.__data__=new St;++r<e;)this.add(t[r])}wn.prototype.add=wn.prototype.push=gn,wn.prototype.has=jn;var mn=wn;var _n=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n;)if(r(t[e],e,t))return!0;return!1};var On=function(t,r){return t.has(r)},xn=1,An=2;var Sn=function(t,r,e,n,o,u){var a=e&xn,i=t.length,c=r.length;if(i!=c&&!(a&&c>i))return!1;var f=u.get(t);if(f&&u.get(r))return f==r;var s=-1,l=!0,v=e&An?new mn:void 0;for(u.set(t,r),u.set(r,t);++s<i;){var p=t[s],h=r[s];if(n)var d=a?n(h,p,s,r,t,u):n(p,h,s,t,r,u);if(void 0!==d){if(d)continue;l=!1;break}if(v){if(!_n(r,(function(t,r){if(!On(v,r)&&(p===t||o(p,t,e,n,u)))return v.push(r)}))){l=!1;break}}else if(p!==h&&!o(p,h,e,n,u)){l=!1;break}}return u.delete(t),u.delete(r),l};var kn=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t,n){e[++r]=[n,t]})),e};var En=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t){e[++r]=t})),e},Pn=1,Ln=2,zn="[object Boolean]",Fn="[object Date]",Bn="[object Error]",Nn="[object Map]",Mn="[object Number]",Gn="[object RegExp]",In="[object Set]",Un="[object String]",Tn="[object Symbol]",Dn="[object ArrayBuffer]",$n="[object DataView]",Rn=S?S.prototype:void 0,Cn=Rn?Rn.valueOf:void 0;var Vn=function(t,r,e,n,o,u,a){switch(e){case $n:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case Dn:return!(t.byteLength!=r.byteLength||!u(new Jr(t),new Jr(r)));case zn:case Fn:case Mn:return s(+t,+r);case Bn:return t.name==r.name&&t.message==r.message;case Gn:case Un:return t==r+"";case Nn:var i=kn;case In:var c=n&Pn;if(i||(i=En),t.size!=r.size&&!c)return!1;var f=a.get(t);if(f)return f==r;n|=Ln,a.set(t,r);var l=Sn(i(t),i(r),n,o,u,a);return a.delete(t),l;case Tn:if(Cn)return Cn.call(t)==Cn.call(r)}return!1},qn=1,Wn=Object.prototype.hasOwnProperty;var Yn=function(t,r,e,n,o,u){var a=e&qn,i=Nr(t),c=i.length;if(c!=Nr(r).length&&!a)return!1;for(var f=c;f--;){var s=i[f];if(!(a?s in r:Wn.call(r,s)))return!1}var l=u.get(t);if(l&&u.get(r))return l==r;var v=!0;u.set(t,r),u.set(r,t);for(var p=a;++f<c;){var h=t[s=i[f]],d=r[s];if(n)var y=a?n(d,h,s,r,t,u):n(h,d,s,t,r,u);if(!(void 0===y?h===d||o(h,d,e,n,u):y)){v=!1;break}p||(p="constructor"==s)}if(v&&!p){var b=t.constructor,g=r.constructor;b!=g&&"constructor"in t&&"constructor"in r&&!("function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g)&&(v=!1)}return u.delete(t),u.delete(r),v},Hn=1,Jn="[object Arguments]",Kn="[object Array]",Qn="[object Object]",Xn=Object.prototype.hasOwnProperty;var Zn=function(t,r,e,n,o,u){var a=qt(t),i=qt(r),c=a?Kn:Wr(t),f=i?Kn:Wr(r),s=(c=c==Jn?Qn:c)==Qn,l=(f=f==Jn?Qn:f)==Qn,v=c==f;if(v&&Yt(t)){if(!Yt(r))return!1;a=!0,s=!1}if(v&&!s)return u||(u=new Lt),a||or(t)?Sn(t,r,e,n,o,u):Vn(t,r,c,e,n,o,u);if(!(e&Hn)){var p=s&&Xn.call(t,"__wrapped__"),h=l&&Xn.call(r,"__wrapped__");if(p||h){var d=p?t.value():t,y=h?r.value():r;return u||(u=new Lt),o(d,y,e,n,u)}}return!!v&&(u||(u=new Lt),Yn(t,r,e,n,o,u))};var to=function t(r,e,n,o,u){return r===e||(null==r||null==e||!Ut(r)&&!Ut(e)?r!=r&&e!=e:Zn(r,e,n,o,t,u))},ro=1,eo=2;var no=function(t,r,e,n){var o=e.length,u=o,a=!n;if(null==t)return!u;for(t=Object(t);o--;){var i=e[o];if(a&&i[2]?i[1]!==t[i[0]]:!(i[0]in t))return!1}for(;++o<u;){var c=(i=e[o])[0],f=t[c],s=i[1];if(a&&i[2]){if(void 0===f&&!(c in t))return!1}else{var l=new Lt;if(n)var v=n(f,s,c,t,r,l);if(!(void 0===v?to(s,f,ro|eo,n,l):v))return!1}}return!0};var oo=function(t){return t==t&&!U(t)};var uo=function(t){for(var r=hr(t),e=r.length;e--;){var n=r[e],o=t[n];r[e]=[n,o,oo(o)]}return r};var ao=function(t,r){return function(e){return null!=e&&(e[t]===r&&(void 0!==r||t in Object(e)))}};var io=function(t){var r=uo(t);return 1==r.length&&r[0][2]?ao(r[0][0],r[0][1]):function(e){return e===t||no(e,t,r)}};var co=function(t,r){return null!=t&&r in Object(t)};var fo=function(t,r,e){for(var n=-1,o=(r=vn(r,t)).length,u=!1;++n<o;){var a=hn(r[n]);if(!(u=null!=t&&e(t,a)))break;t=t[a]}return u||++n!=o?u:!!(o=null==t?0:t.length)&&Xt(o)&&Kt(a,o)&&(qt(t)||Vt(t))};var so=function(t,r){return null!=t&&fo(t,r,co)},lo=1,vo=2;var po=function(t,r){return Qe(t)&&oo(r)?ao(hn(t),r):function(e){var n=yn(e,t);return void 0===n&&n===r?so(e,t):to(r,n,lo|vo)}};var ho=function(t){return t};var yo=function(t){return function(r){return null==r?void 0:r[t]}};var bo=function(t){return function(r){return dn(r,t)}};var go=function(t){return Qe(t)?yo(hn(t)):bo(t)};var jo=function(t){return"function"==typeof t?t:null==t?ho:"object"==n(t)?qt(t)?po(t[0],t[1]):io(t):go(t)};var wo=function(t){return function(r,e,n){for(var o=-1,u=Object(r),a=n(r),i=a.length;i--;){var c=a[t?i:++o];if(!1===e(u[c],c,u))break}return r}}();var mo=function(t,r){return function(e,n){if(null==e)return e;if(!pr(e))return t(e,n);for(var o=e.length,u=r?o:-1,a=Object(e);(r?u--:++u<o)&&!1!==n(a[u],u,a););return e}}((function(t,r){return t&&wo(t,r,hr)}));var _o=function(t,r){var e=-1,n=pr(t)?Array(t.length):[];return mo(t,(function(t,o,u){n[++e]=r(t,o,u)})),n};var Oo=function(t,r){return(qt(t)?un:_o)(t,jo(r))};var xo=function(t){var r=null==t?0:t.length;return r?t[r-1]:void 0};var Ao=function(t,r,e){var n=-1,o=t.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var u=Array(o);++n<o;)u[n]=t[n+r];return u};var So=function(t,r){return r.length<2?t:dn(t,Ao(r,0,-1))};var ko=function(t,r){return r=vn(r,t),null==(t=So(t,r))||delete t[hn(xo(r))]},Eo="[object Object]",Po=Function.prototype,Lo=Object.prototype,zo=Po.toString,Fo=Lo.hasOwnProperty,Bo=zo.call(Object);var No=function(t){if(!Ut(t)||I(t)!=Eo)return!1;var r=Lr(t);if(null===r)return!0;var e=Fo.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&zo.call(e)==Bo};var Mo=function(t){return No(t)?void 0:t},Go=S?S.isConcatSpreadable:void 0;var Io=function(t){return qt(t)||Vt(t)||!!(Go&&t&&t[Go])};var Uo=function t(r,e,n,o,u){var a=-1,i=r.length;for(n||(n=Io),u||(u=[]);++a<i;){var c=r[a];e>0&&n(c)?e>1?t(c,e-1,n,o,u):Pr(u,c):o||(u[u.length]=c)}return u};var To=function(t){return(null==t?0:t.length)?Uo(t,1):[]};var Do=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},$o=Math.max;var Ro=function(t,r,e){return r=$o(void 0===r?t.length-1:r,0),function(){for(var n=arguments,o=-1,u=$o(n.length-r,0),a=Array(u);++o<u;)a[o]=n[r+o];o=-1;for(var i=Array(r+1);++o<r;)i[o]=n[o];return i[r]=e(a),Do(t,this,i)}};var Co=function(t){return function(){return t}},Vo=Ft?function(t,r){return Ft(t,"toString",{configurable:!0,enumerable:!1,value:Co(r),writable:!0})}:ho,qo=800,Wo=16,Yo=Date.now;var Ho=function(t){var r=0,e=0;return function(){var n=Yo(),o=Wo-(n-e);if(e=n,o>0){if(++r>=qo)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(Vo);var Jo=function(t){return Ho(Ro(t,void 0,To),t+"")}((function(t,r){var e={};if(null==t)return e;var n=!1;r=un(r,(function(r){return r=vn(r,t),n||(n=r.length>1),r})),Gt(t,Mr(t),e),n&&(e=Ce(e,7,Mo));for(var o=r.length;o--;)ko(e,r[o]);return e})),Ko="[object String]";var Qo=function(t){return"string"==typeof t||!qt(t)&&Ut(t)&&I(t)==Ko},Xo=yo("length"),Zo=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var tu=function(t){return Zo.test(t)},ru="[\\ud800-\\udfff]",eu="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",nu="\\ud83c[\\udffb-\\udfff]",ou="[^\\ud800-\\udfff]",uu="(?:\\ud83c[\\udde6-\\uddff]){2}",au="[\\ud800-\\udbff][\\udc00-\\udfff]",iu="(?:"+eu+"|"+nu+")"+"?",cu="[\\ufe0e\\ufe0f]?"+iu+("(?:\\u200d(?:"+[ou,uu,au].join("|")+")[\\ufe0e\\ufe0f]?"+iu+")*"),fu="(?:"+[ou+eu+"?",eu,uu,au,ru].join("|")+")",su=RegExp(nu+"(?="+nu+")|"+fu+cu,"g");var lu=function(t){for(var r=su.lastIndex=0;su.test(t);)++r;return r};var vu=function(t){return tu(t)?lu(t):Xo(t)},pu="[object Map]",hu="[object Set]";var du=function(t){if(null==t)return 0;if(pr(t))return Qo(t)?vu(t):t.length;var r=Wr(t);return r==pu||r==hu?t.size:vr(t).length};function yu(){var t,r,e=new Promise((function(){t=arguments[0],r=arguments[1]}));return e.resolve=t,e.reject=r,e}var bu=NaN,gu=/^\s+|\s+$/g,ju=/^[-+]0x[0-9a-f]+$/i,wu=/^0b[01]+$/i,mu=/^0o[0-7]+$/i,_u=parseInt;var Ou=function(t){if("number"==typeof t)return t;if(He(t))return bu;if(U(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=U(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(gu,"");var e=wu.test(t);return e||mu.test(t)?_u(t.slice(2),e?2:8):ju.test(t)?bu:+t},xu=1/0,Au=17976931348623157e292;var Su=function(t){return t?(t=Ou(t))===xu||t===-xu?(t<0?-1:1)*Au:t==t?t:0:0===t?t:0};var ku=function(t){var r=Su(t),e=r%1;return r==r?e?r-e:r:0};var Eu=function(t){return"number"==typeof t&&t==ku(t)};function Pu(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}function Lu(t){var r=!1;return Pu(t)?r=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(r=!0),r}function zu(t){return Lu(t)?Su(t):0}var Fu=A.isFinite,Bu=Math.min;var Nu=function(t){var r=Math[t];return function(t,e){if(t=Ou(t),(e=null==e?0:Bu(ku(e),292))&&Fu(t)){var n=(ln(t)+"e").split("e"),o=r(n[0]+"e"+(+n[1]+e));return+((n=(ln(o)+"e").split("e"))[0]+"e"+(+n[1]-e))}return r(t)}}("round");function Mu(t){return!!function(t){return!!Lu(t)&&(t=zu(t),Eu(t))}(t)&&function(t){if(!Lu(t))return 0;t=zu(t);var r=Nu(t);return"0"===String(r)?0:r}(t)>0}function Gu(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],o=e.length;if(Mu(r))for(t=0;t<r;t++)n[t]=e[0|Math.random()*o];else{if("rfc4122"!==r)return"";var u;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(u=0|16*Math.random(),n[t]=e[19===t?3&u|8:u])}return n.join("")}function Iu(t){return"[object Array]"===Object.prototype.toString.call(t)}var Uu=function(t,r,e){var n=null==t?0:t.length;return n?(r=e||void 0===r?1:ku(r),Ao(t,r<0?0:r,n)):[]};function Tu(t,r){var e,n,o=yu();if(!Iu(t))return o.reject("rs is not array"),o;e=r,"[object Function]"!==(n=Object.prototype.toString.call(e))&&"[object AsyncFunction]"!==n&&(r=function(t){return t});var u=-1,a=[];return t.reduce((function(t,e){return t.then((function(t){return a.push(t),r(e,u+=1)}))}),Promise.resolve()).then((function(t){a.push(t),a=Uu(a),o.resolve(a)})).catch((function(t){o.reject(t)})),o}var Du={useNewUrlParser:!0,useUnifiedTopology:!0};return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.url||(n.url="mongodb://127.0.0.1:27017"),n.db||(n.db="worm"),n.cl||(n.cl="test");var o=new t.EventEmitter,u=r.MongoClient;function i(){return(i=c(a.mark((function t(){var r,e,o,i,c=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.length>0&&void 0!==c[0]?c[0]:{},e=yu(),t.next=4,u.connect(n.url,Du);case 4:return o=t.sent,i=o.db(n.db),i.collection(n.cl).find(r).toArray((function(t,r){t?e.reject(t):(r=Oo(r,(function(t){return t=Jo(t,"_id")})),e.resolve(r)),o.close()})),t.abrupt("return",e);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(t){return s.apply(this,arguments)}function s(){return(s=c(a.mark((function t(r){var e,i,c,f;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=We(r),e=yu(),t.next=4,u.connect(n.url,Du);case 4:return i=t.sent,c=i.db(n.db),f=c.collection(n.cl),Iu(r)||(r=[r]),r=Oo(r,(function(t){return t.id||(t.id=Gu()),t})),f.insertMany(r,(function(t,n){t?e.reject(t):n.insertedCount>0?(n=n.result,e.resolve(n),o.emit("change","insert",r,n)):e.reject(t),i.close()})),t.abrupt("return",e);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(){return(l=c(a.mark((function t(r){var e,i,c,s,l,v,p,h,d=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=d.length>1&&void 0!==d[1]?d[1]:{},r=We(r),i=yn(e,"autoInsert",!0),c=yn(e,"atomic",!1),s=yu(),t.next=7,u.connect(n.url,Du);case 7:return l=t.sent,v=l.db(n.db),p=v.collection(n.cl),Iu(r)||(r=[r]),h=null,h=c?"findOneAndUpdate":"updateOne",Tu(r,(function(t){var r=yu();return p[h]({id:t.id},{$set:t},(function(e,n){e?r.reject(e):(n.lastErrorObject&&(n.result={n:n.lastErrorObject.n,nModified:n.lastErrorObject.updatedExisting?1:0,ok:1}),i&&0===n.result.n?f(t).then((function(t){t.nInserted=1,r.resolve(t)})).catch((function(t){r.reject(t)})):r.resolve(n.result))})),r})).then((function(t){s.resolve(t),o.emit("change","save",r,t)})).catch((function(t){s.reject(t)})).finally((function(){l.close()})),t.abrupt("return",s);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(){return(v=c(a.mark((function t(r){var e,i,c,f;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=We(r),e=yu(),t.next=4,u.connect(n.url,Du);case 4:return i=t.sent,c=i.db(n.db),f=c.collection(n.cl),Iu(r)||(r=[r]),Tu(r,(function(t){var r=yu();return f.deleteOne({id:t.id},(function(t,e){t?r.resolve(t):((e=e.result).nDeleted=1,r.resolve(e))})),r})).then((function(t){e.resolve(t),o.emit("change","del",r,t)})).catch((function(t){e.reject(t)})).finally((function(){i.close()})),t.abrupt("return",e);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(){return(p=c(a.mark((function t(){var r,e,i,c,f=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=f.length>0&&void 0!==f[0]?f[0]:{},e=yu(),t.next=4,u.connect(n.url,Du);case 4:return i=t.sent,c=i.db(n.db),c.collection(n.cl).deleteMany(r,(function(t,r){t?e.resolve(t):(r=r.result,e.resolve(r),o.emit("change","delAll",null,r)),i.close()})),t.abrupt("return",e);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(){return(h=c(a.mark((function t(i){var c,f,s,l,v,p,h;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=yu(),f=Gu(),s=Buffer.from(i),t.next=5,u.connect(n.url,Du);case 5:return l=t.sent,v=l.db(n.db),p=new r.GridFSBucket(v,{chunkSizeBytes:10485760,bucketName:n.cl}),(h=new e.Readable)._read=function(){},h.push(s),h.push(null),h.pipe(p.openUploadStream(f)).on("error",(function(t){c.reject(t),l.close()})).on("finish",(function(){var t={n:1,ok:1,id:f};c.resolve(t),o.emit("change","insertGfs",null,t),l.close()})),t.abrupt("return",c);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(){return(d=c(a.mark((function t(e){var o,i,c,f,s,l;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=yu(),t.next=3,u.connect(n.url,Du);case 3:return i=t.sent,c=i.db(n.db),f=new r.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:n.cl}),s=Buffer.from(""),(l=f.openDownloadStreamByName(e)).on("data",(function(t){s=Buffer.concat([s,t])})),l.on("error",(function(t){o.reject(t),i.close()})),l.on("end",(function(){var t=new Uint8Array(s);s=null,o.resolve(t),i.close()})),t.abrupt("return",o);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(){return b.apply(this,arguments)}function b(){return(b=c(a.mark((function t(){var e,o,i,c,f,s=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:{},o=s.length>1&&void 0!==s[1]?s[1]:null,i=yu(),null!==o){t.next=9;break}return t.next=6,u.connect(n.url,Du);case 6:c=t.sent,f=c.db(n.db),o=new r.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:n.cl});case 9:return o.find(e).toArray((function(t,r){t?i.reject(t):i.resolve(r)})),t.abrupt("return",i);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(){return(g=c(a.mark((function t(e){var i,c,f,s,l,v;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=yu(),t.next=3,u.connect(n.url,Du);case 3:return c=t.sent,f=c.db(n.db),s=new r.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:n.cl}),t.next=8,y({filename:e},s);case 8:return 0===(l=t.sent).length?(i.reject("can not find id"),c.close()):l.length>1?(i.reject("duplicate id"),c.close()):(v=l[0]._id,s.delete(v,(function(t){if(t)i.reject(t);else{var r={n:1,nDeleted:1,ok:1};i.resolve(r),o.emit("change","delGfs",null,r)}c.close()}))),t.abrupt("return",i);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function j(t,r){return w.apply(this,arguments)}function w(){return(w=c(a.mark((function t(r,e){var n;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=yu(),e.delete(r,(function(t){t?n.reject(t):n.resolve({n:1,nDeleted:1,ok:1})})),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(){return(m=c(a.mark((function t(){var e,i,c,f,s,l,v,p,h=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.length>0&&void 0!==h[0]?h[0]:{},i=yu(),t.next=4,u.connect(n.url,Du);case 4:return c=t.sent,f=c.db(n.db),s=new r.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:n.cl}),t.next=9,y(e,s);case 9:return l=t.sent,v=du(l),p=Oo(l,(function(t){return j(t._id,s)})),Promise.all(p).then((function(t){var r={n:v,ok:1};i.resolve(r),o.emit("change","delAllGfs",null,r)})).catch((function(t){i.reject(t)})).finally((function(){c.close()})),t.abrupt("return",i);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return o.select=function(){return i.apply(this,arguments)},o.insert=f,o.save=function(t){return l.apply(this,arguments)},o.del=function(t){return v.apply(this,arguments)},o.delAll=function(){return p.apply(this,arguments)},o.selectGfs=function(t){return d.apply(this,arguments)},o.insertGfs=function(t){return h.apply(this,arguments)},o.delGfs=function(t){return g.apply(this,arguments)},o.delAllGfs=function(){return m.apply(this,arguments)},o}}));
//# sourceMappingURL=w-orm-mongodb.umd.js.map
