/*!
 * w-orm-mongodb v1.1.18
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["events","mongodb","stream"],r):(t=t||self)["w-orm-mongodb"]=r(t.events,t.mongodb,t.stream)}(this,(function(t,r,e){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(t,r){return t(r={exports:{}},r.exports),r.exports}var u=o((function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r})),a=o((function(t){var r=function(t){var r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function i(t,r,e,n){var o=r&&r.prototype instanceof l?r:l,u=Object.create(o.prototype),a=new O(n||[]);return u._invoke=function(t,r,e){var n="suspendedStart";return function(o,u){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw u;return A()}for(e.method=o,e.arg=u;;){var a=e.delegate;if(a){var c=w(a,e);if(c){if(c===s)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var i=f(t,r,e);if("normal"===i.type){if(n=e.done?"completed":"suspendedYield",i.arg===s)continue;return{value:i.arg,done:e.done}}"throw"===i.type&&(n="completed",e.method="throw",e.arg=i.arg)}}}(t,e,a),u}function f(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=i;var s={};function l(){}function v(){}function p(){}var h={};h[o]=function(){return this};var d=Object.getPrototypeOf,y=d&&d(d(x([])));y&&y!==r&&e.call(y,o)&&(h=y);var b=p.prototype=l.prototype=Object.create(h);function g(t){["next","throw","return"].forEach((function(r){t[r]=function(t){return this._invoke(r,t)}}))}function j(t,r){var n;this._invoke=function(o,a){function c(){return new r((function(n,c){!function n(o,a,c,i){var s=f(t[o],t,a);if("throw"!==s.type){var l=s.arg,v=l.value;return v&&"object"===u(v)&&e.call(v,"__await")?r.resolve(v.__await).then((function(t){n("next",t,c,i)}),(function(t){n("throw",t,c,i)})):r.resolve(v).then((function(t){l.value=t,c(l)}),(function(t){return n("throw",t,c,i)}))}i(s.arg)}(o,a,n,c)}))}return n=n?n.then(c,c):c()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return s;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=f(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,s;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,s):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,s)}function m(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function _(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(m,this),this.reset(!0)}function x(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,u=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return u.next=u}}return{next:A}}function A(){return{value:void 0,done:!0}}return v.prototype=b.constructor=p,p.constructor=v,p[c]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===v||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(j.prototype),j.prototype[a]=function(){return this},t.AsyncIterator=j,t.async=function(r,e,n,o,u){void 0===u&&(u=Promise);var a=new j(i(r,e,n,o),u);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),b[c]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=x,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var u=this.tryEntries[o],a=u.completion;if("root"===u.tryLoc)return n("end");if(u.tryLoc<=this.prev){var c=e.call(u,"catchLoc"),i=e.call(u,"finallyLoc");if(c&&i){if(this.prev<u.catchLoc)return n(u.catchLoc,!0);if(this.prev<u.finallyLoc)return n(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return n(u.catchLoc,!0)}else{if(!i)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return n(u.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var u=o;break}}u&&("break"===t||"continue"===t)&&u.tryLoc<=r&&r<=u.finallyLoc&&(u=null);var a=u?u.completion:{};return a.type=t,a.arg=r,u?(this.method="next",this.next=u.finallyLoc,s):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),s},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),_(e),s}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;_(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:x(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),s}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}}));function c(t,r,e,n,o,u,a){try{var c=t[u](a),i=c.value}catch(t){return void e(t)}c.done?r(i):Promise.resolve(i).then(n,o)}var i=function(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var u=t.apply(r,e);function a(t){c(u,n,o,a,i,"next",t)}function i(t){c(u,n,o,a,i,"throw",t)}a(void 0)}))}};var f=function(){this.__data__=[],this.size=0};var s=function(t,r){return t===r||t!=t&&r!=r};var l=function(t,r){for(var e=t.length;e--;)if(s(t[e][0],r))return e;return-1},v=Array.prototype.splice;var p=function(t){var r=this.__data__,e=l(r,t);return!(e<0)&&(e==r.length-1?r.pop():v.call(r,e,1),--this.size,!0)};var h=function(t){var r=this.__data__,e=l(r,t);return e<0?void 0:r[e][1]};var d=function(t){return l(this.__data__,t)>-1};var y=function(t,r){var e=this.__data__,n=l(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function b(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}b.prototype.clear=f,b.prototype.delete=p,b.prototype.get=h,b.prototype.has=d,b.prototype.set=y;var g=b;var j=function(){this.__data__=new g,this.size=0};var w=function(t){var r=this.__data__,e=r.delete(t);return this.size=r.size,e};var m=function(t){return this.__data__.get(t)};var _=function(t){return this.__data__.has(t)},O="object"==u(n)&&n&&n.Object===Object&&n,x="object"==("undefined"==typeof self?"undefined":u(self))&&self&&self.Object===Object&&self,A=O||x||Function("return this")(),S=A.Symbol,k=Object.prototype,E=k.hasOwnProperty,P=k.toString,L=S?S.toStringTag:void 0;var z=function(t){var r=E.call(t,L),e=t[L];try{t[L]=void 0;var n=!0}catch(t){}var o=P.call(t);return n&&(r?t[L]=e:delete t[L]),o},F=Object.prototype.toString;var N=function(t){return F.call(t)},B=S?S.toStringTag:void 0;var M=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":B&&B in Object(t)?z(t):N(t)};var G=function(t){var r=u(t);return null!=t&&("object"==r||"function"==r)};var I,U=function(t){if(!G(t))return!1;var r=M(t);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r},T=A["__core-js_shared__"],D=(I=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+I:"";var $=function(t){return!!D&&D in t},R=Function.prototype.toString;var C=function(t){if(null!=t){try{return R.call(t)}catch(t){}try{return t+""}catch(t){}}return""},V=/^\[object .+?Constructor\]$/,q=Function.prototype,W=Object.prototype,Y=q.toString,H=W.hasOwnProperty,J=RegExp("^"+Y.call(H).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var K=function(t){return!(!G(t)||$(t))&&(U(t)?J:V).test(C(t))};var Q=function(t,r){return null==t?void 0:t[r]};var X=function(t,r){var e=Q(t,r);return K(e)?e:void 0},Z=X(A,"Map"),tt=X(Object,"create");var rt=function(){this.__data__=tt?tt(null):{},this.size=0};var et=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},nt=Object.prototype.hasOwnProperty;var ot=function(t){var r=this.__data__;if(tt){var e=r[t];return"__lodash_hash_undefined__"===e?void 0:e}return nt.call(r,t)?r[t]:void 0},ut=Object.prototype.hasOwnProperty;var at=function(t){var r=this.__data__;return tt?void 0!==r[t]:ut.call(r,t)};var ct=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=tt&&void 0===r?"__lodash_hash_undefined__":r,this};function it(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}it.prototype.clear=rt,it.prototype.delete=et,it.prototype.get=ot,it.prototype.has=at,it.prototype.set=ct;var ft=it;var st=function(){this.size=0,this.__data__={hash:new ft,map:new(Z||g),string:new ft}};var lt=function(t){var r=u(t);return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var vt=function(t,r){var e=t.__data__;return lt(r)?e["string"==typeof r?"string":"hash"]:e.map};var pt=function(t){var r=vt(this,t).delete(t);return this.size-=r?1:0,r};var ht=function(t){return vt(this,t).get(t)};var dt=function(t){return vt(this,t).has(t)};var yt=function(t,r){var e=vt(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function bt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}bt.prototype.clear=st,bt.prototype.delete=pt,bt.prototype.get=ht,bt.prototype.has=dt,bt.prototype.set=yt;var gt=bt;var jt=function(t,r){var e=this.__data__;if(e instanceof g){var n=e.__data__;if(!Z||n.length<199)return n.push([t,r]),this.size=++e.size,this;e=this.__data__=new gt(n)}return e.set(t,r),this.size=e.size,this};function wt(t){var r=this.__data__=new g(t);this.size=r.size}wt.prototype.clear=j,wt.prototype.delete=w,wt.prototype.get=m,wt.prototype.has=_,wt.prototype.set=jt;var mt=wt;var _t=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t},Ot=function(){try{var t=X(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var xt=function(t,r,e){"__proto__"==r&&Ot?Ot(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},At=Object.prototype.hasOwnProperty;var St=function(t,r,e){var n=t[r];At.call(t,r)&&s(n,e)&&(void 0!==e||r in t)||xt(t,r,e)};var kt=function(t,r,e,n){var o=!e;e||(e={});for(var u=-1,a=r.length;++u<a;){var c=r[u],i=n?n(e[c],t[c],c,e,t):void 0;void 0===i&&(i=t[c]),o?xt(e,c,i):St(e,c,i)}return e};var Et=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n};var Pt=function(t){return null!=t&&"object"==u(t)};var Lt=function(t){return Pt(t)&&"[object Arguments]"==M(t)},zt=Object.prototype,Ft=zt.hasOwnProperty,Nt=zt.propertyIsEnumerable,Bt=Lt(function(){return arguments}())?Lt:function(t){return Pt(t)&&Ft.call(t,"callee")&&!Nt.call(t,"callee")},Mt=Array.isArray;var Gt=function(){return!1},It=o((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?A.Buffer:void 0,u=(o?o.isBuffer:void 0)||Gt;t.exports=u})),Ut=/^(?:0|[1-9]\d*)$/;var Tt=function(t,r){var e=u(t);return!!(r=null==r?9007199254740991:r)&&("number"==e||"symbol"!=e&&Ut.test(t))&&t>-1&&t%1==0&&t<r};var Dt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},$t={};$t["[object Float32Array]"]=$t["[object Float64Array]"]=$t["[object Int8Array]"]=$t["[object Int16Array]"]=$t["[object Int32Array]"]=$t["[object Uint8Array]"]=$t["[object Uint8ClampedArray]"]=$t["[object Uint16Array]"]=$t["[object Uint32Array]"]=!0,$t["[object Arguments]"]=$t["[object Array]"]=$t["[object ArrayBuffer]"]=$t["[object Boolean]"]=$t["[object DataView]"]=$t["[object Date]"]=$t["[object Error]"]=$t["[object Function]"]=$t["[object Map]"]=$t["[object Number]"]=$t["[object Object]"]=$t["[object RegExp]"]=$t["[object Set]"]=$t["[object String]"]=$t["[object WeakMap]"]=!1;var Rt=function(t){return Pt(t)&&Dt(t.length)&&!!$t[M(t)]};var Ct=function(t){return function(r){return t(r)}},Vt=o((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&O.process,u=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=u})),qt=Vt&&Vt.isTypedArray,Wt=qt?Ct(qt):Rt,Yt=Object.prototype.hasOwnProperty;var Ht=function(t,r){var e=Mt(t),n=!e&&Bt(t),o=!e&&!n&&It(t),u=!e&&!n&&!o&&Wt(t),a=e||n||o||u,c=a?Et(t.length,String):[],i=c.length;for(var f in t)!r&&!Yt.call(t,f)||a&&("length"==f||o&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Tt(f,i))||c.push(f);return c},Jt=Object.prototype;var Kt=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||Jt)};var Qt=function(t,r){return function(e){return t(r(e))}},Xt=Qt(Object.keys,Object),Zt=Object.prototype.hasOwnProperty;var tr=function(t){if(!Kt(t))return Xt(t);var r=[];for(var e in Object(t))Zt.call(t,e)&&"constructor"!=e&&r.push(e);return r};var rr=function(t){return null!=t&&Dt(t.length)&&!U(t)};var er=function(t){return rr(t)?Ht(t):tr(t)};var nr=function(t,r){return t&&kt(r,er(r),t)};var or=function(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r},ur=Object.prototype.hasOwnProperty;var ar=function(t){if(!G(t))return or(t);var r=Kt(t),e=[];for(var n in t)("constructor"!=n||!r&&ur.call(t,n))&&e.push(n);return e};var cr=function(t){return rr(t)?Ht(t,!0):ar(t)};var ir=function(t,r){return t&&kt(r,cr(r),t)},fr=o((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?A.Buffer:void 0,u=o?o.allocUnsafe:void 0;t.exports=function(t,r){if(r)return t.slice();var e=t.length,n=u?u(e):new t.constructor(e);return t.copy(n),n}}));var sr=function(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r};var lr=function(t,r){for(var e=-1,n=null==t?0:t.length,o=0,u=[];++e<n;){var a=t[e];r(a,e,t)&&(u[o++]=a)}return u};var vr=function(){return[]},pr=Object.prototype.propertyIsEnumerable,hr=Object.getOwnPropertySymbols,dr=hr?function(t){return null==t?[]:(t=Object(t),lr(hr(t),(function(r){return pr.call(t,r)})))}:vr;var yr=function(t,r){return kt(t,dr(t),r)};var br=function(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t},gr=Qt(Object.getPrototypeOf,Object),jr=Object.getOwnPropertySymbols?function(t){for(var r=[];t;)br(r,dr(t)),t=gr(t);return r}:vr;var wr=function(t,r){return kt(t,jr(t),r)};var mr=function(t,r,e){var n=r(t);return Mt(t)?n:br(n,e(t))};var _r=function(t){return mr(t,er,dr)};var Or=function(t){return mr(t,cr,jr)},xr=X(A,"DataView"),Ar=X(A,"Promise"),Sr=X(A,"Set"),kr=X(A,"WeakMap"),Er=C(xr),Pr=C(Z),Lr=C(Ar),zr=C(Sr),Fr=C(kr),Nr=M;(xr&&"[object DataView]"!=Nr(new xr(new ArrayBuffer(1)))||Z&&"[object Map]"!=Nr(new Z)||Ar&&"[object Promise]"!=Nr(Ar.resolve())||Sr&&"[object Set]"!=Nr(new Sr)||kr&&"[object WeakMap]"!=Nr(new kr))&&(Nr=function(t){var r=M(t),e="[object Object]"==r?t.constructor:void 0,n=e?C(e):"";if(n)switch(n){case Er:return"[object DataView]";case Pr:return"[object Map]";case Lr:return"[object Promise]";case zr:return"[object Set]";case Fr:return"[object WeakMap]"}return r});var Br=Nr,Mr=Object.prototype.hasOwnProperty;var Gr=function(t){var r=t.length,e=new t.constructor(r);return r&&"string"==typeof t[0]&&Mr.call(t,"index")&&(e.index=t.index,e.input=t.input),e},Ir=A.Uint8Array;var Ur=function(t){var r=new t.constructor(t.byteLength);return new Ir(r).set(new Ir(t)),r};var Tr=function(t,r){var e=r?Ur(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)},Dr=/\w*$/;var $r=function(t){var r=new t.constructor(t.source,Dr.exec(t));return r.lastIndex=t.lastIndex,r},Rr=S?S.prototype:void 0,Cr=Rr?Rr.valueOf:void 0;var Vr=function(t){return Cr?Object(Cr.call(t)):{}};var qr=function(t,r){var e=r?Ur(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)};var Wr=function(t,r,e){var n=t.constructor;switch(r){case"[object ArrayBuffer]":return Ur(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return Tr(t,e);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return qr(t,e);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return $r(t);case"[object Set]":return new n;case"[object Symbol]":return Vr(t)}},Yr=Object.create,Hr=function(){function t(){}return function(r){if(!G(r))return{};if(Yr)return Yr(r);t.prototype=r;var e=new t;return t.prototype=void 0,e}}();var Jr=function(t){return"function"!=typeof t.constructor||Kt(t)?{}:Hr(gr(t))};var Kr=function(t){return Pt(t)&&"[object Map]"==Br(t)},Qr=Vt&&Vt.isMap,Xr=Qr?Ct(Qr):Kr;var Zr=function(t){return Pt(t)&&"[object Set]"==Br(t)},te=Vt&&Vt.isSet,re=te?Ct(te):Zr,ee={};ee["[object Arguments]"]=ee["[object Array]"]=ee["[object ArrayBuffer]"]=ee["[object DataView]"]=ee["[object Boolean]"]=ee["[object Date]"]=ee["[object Float32Array]"]=ee["[object Float64Array]"]=ee["[object Int8Array]"]=ee["[object Int16Array]"]=ee["[object Int32Array]"]=ee["[object Map]"]=ee["[object Number]"]=ee["[object Object]"]=ee["[object RegExp]"]=ee["[object Set]"]=ee["[object String]"]=ee["[object Symbol]"]=ee["[object Uint8Array]"]=ee["[object Uint8ClampedArray]"]=ee["[object Uint16Array]"]=ee["[object Uint32Array]"]=!0,ee["[object Error]"]=ee["[object Function]"]=ee["[object WeakMap]"]=!1;var ne=function t(r,e,n,o,u,a){var c,i=1&e,f=2&e,s=4&e;if(n&&(c=u?n(r,o,u,a):n(r)),void 0!==c)return c;if(!G(r))return r;var l=Mt(r);if(l){if(c=Gr(r),!i)return sr(r,c)}else{var v=Br(r),p="[object Function]"==v||"[object GeneratorFunction]"==v;if(It(r))return fr(r,i);if("[object Object]"==v||"[object Arguments]"==v||p&&!u){if(c=f||p?{}:Jr(r),!i)return f?wr(r,ir(c,r)):yr(r,nr(c,r))}else{if(!ee[v])return u?r:{};c=Wr(r,v,i)}}a||(a=new mt);var h=a.get(r);if(h)return h;a.set(r,c),re(r)?r.forEach((function(o){c.add(t(o,e,n,o,r,a))})):Xr(r)&&r.forEach((function(o,u){c.set(u,t(o,e,n,u,r,a))}));var d=s?f?Or:_r:f?keysIn:er,y=l?void 0:d(r);return _t(y||r,(function(o,u){y&&(o=r[u=o]),St(c,u,t(o,e,n,u,r,a))})),c};var oe=function(t){return ne(t,5)};var ue=function(t){return"symbol"==u(t)||Pt(t)&&"[object Symbol]"==M(t)},ae=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ce=/^\w*$/;var ie=function(t,r){if(Mt(t))return!1;var e=u(t);return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!ue(t))||(ce.test(t)||!ae.test(t)||null!=r&&t in Object(r))};function fe(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var e=function e(){var n=arguments,o=r?r.apply(this,n):n[0],u=e.cache;if(u.has(o))return u.get(o);var a=t.apply(this,n);return e.cache=u.set(o,a)||u,a};return e.cache=new(fe.Cache||gt),e}fe.Cache=gt;var se=fe;var le=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ve=/\\(\\)?/g,pe=function(t){var r=se(t,(function(t){return 500===e.size&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(le,(function(t,e,n,o){r.push(n?o.replace(ve,"$1"):e||t)})),r}));var he=function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o},de=S?S.prototype:void 0,ye=de?de.toString:void 0;var be=function t(r){if("string"==typeof r)return r;if(Mt(r))return he(r,t)+"";if(ue(r))return ye?ye.call(r):"";var e=r+"";return"0"==e&&1/r==-1/0?"-0":e};var ge=function(t){return null==t?"":be(t)};var je=function(t,r){return Mt(t)?t:ie(t,r)?[t]:pe(ge(t))};var we=function(t){if("string"==typeof t||ue(t))return t;var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};var me=function(t,r){for(var e=0,n=(r=je(r,t)).length;null!=t&&e<n;)t=t[we(r[e++])];return e&&e==n?t:void 0};var _e=function(t,r,e){var n=null==t?void 0:me(t,r);return void 0===n?e:n};var Oe=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var xe=function(t){return this.__data__.has(t)};function Ae(t){var r=-1,e=null==t?0:t.length;for(this.__data__=new gt;++r<e;)this.add(t[r])}Ae.prototype.add=Ae.prototype.push=Oe,Ae.prototype.has=xe;var Se=Ae;var ke=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n;)if(r(t[e],e,t))return!0;return!1};var Ee=function(t,r){return t.has(r)};var Pe=function(t,r,e,n,o,u){var a=1&e,c=t.length,i=r.length;if(c!=i&&!(a&&i>c))return!1;var f=u.get(t);if(f&&u.get(r))return f==r;var s=-1,l=!0,v=2&e?new Se:void 0;for(u.set(t,r),u.set(r,t);++s<c;){var p=t[s],h=r[s];if(n)var d=a?n(h,p,s,r,t,u):n(p,h,s,t,r,u);if(void 0!==d){if(d)continue;l=!1;break}if(v){if(!ke(r,(function(t,r){if(!Ee(v,r)&&(p===t||o(p,t,e,n,u)))return v.push(r)}))){l=!1;break}}else if(p!==h&&!o(p,h,e,n,u)){l=!1;break}}return u.delete(t),u.delete(r),l};var Le=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t,n){e[++r]=[n,t]})),e};var ze=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t){e[++r]=t})),e},Fe=S?S.prototype:void 0,Ne=Fe?Fe.valueOf:void 0;var Be=function(t,r,e,n,o,u,a){switch(e){case"[object DataView]":if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=r.byteLength||!u(new Ir(t),new Ir(r)));case"[object Boolean]":case"[object Date]":case"[object Number]":return s(+t,+r);case"[object Error]":return t.name==r.name&&t.message==r.message;case"[object RegExp]":case"[object String]":return t==r+"";case"[object Map]":var c=Le;case"[object Set]":var i=1&n;if(c||(c=ze),t.size!=r.size&&!i)return!1;var f=a.get(t);if(f)return f==r;n|=2,a.set(t,r);var l=Pe(c(t),c(r),n,o,u,a);return a.delete(t),l;case"[object Symbol]":if(Ne)return Ne.call(t)==Ne.call(r)}return!1},Me=Object.prototype.hasOwnProperty;var Ge=function(t,r,e,n,o,u){var a=1&e,c=_r(t),i=c.length;if(i!=_r(r).length&&!a)return!1;for(var f=i;f--;){var s=c[f];if(!(a?s in r:Me.call(r,s)))return!1}var l=u.get(t);if(l&&u.get(r))return l==r;var v=!0;u.set(t,r),u.set(r,t);for(var p=a;++f<i;){var h=t[s=c[f]],d=r[s];if(n)var y=a?n(d,h,s,r,t,u):n(h,d,s,t,r,u);if(!(void 0===y?h===d||o(h,d,e,n,u):y)){v=!1;break}p||(p="constructor"==s)}if(v&&!p){var b=t.constructor,g=r.constructor;b==g||!("constructor"in t)||!("constructor"in r)||"function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g||(v=!1)}return u.delete(t),u.delete(r),v},Ie=Object.prototype.hasOwnProperty;var Ue=function(t,r,e,n,o,u){var a=Mt(t),c=Mt(r),i=a?"[object Array]":Br(t),f=c?"[object Array]":Br(r),s="[object Object]"==(i="[object Arguments]"==i?"[object Object]":i),l="[object Object]"==(f="[object Arguments]"==f?"[object Object]":f),v=i==f;if(v&&It(t)){if(!It(r))return!1;a=!0,s=!1}if(v&&!s)return u||(u=new mt),a||Wt(t)?Pe(t,r,e,n,o,u):Be(t,r,i,e,n,o,u);if(!(1&e)){var p=s&&Ie.call(t,"__wrapped__"),h=l&&Ie.call(r,"__wrapped__");if(p||h){var d=p?t.value():t,y=h?r.value():r;return u||(u=new mt),o(d,y,e,n,u)}}return!!v&&(u||(u=new mt),Ge(t,r,e,n,o,u))};var Te=function t(r,e,n,o,u){return r===e||(null==r||null==e||!Pt(r)&&!Pt(e)?r!=r&&e!=e:Ue(r,e,n,o,t,u))};var De=function(t,r,e,n){var o=e.length,u=o,a=!n;if(null==t)return!u;for(t=Object(t);o--;){var c=e[o];if(a&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++o<u;){var i=(c=e[o])[0],f=t[i],s=c[1];if(a&&c[2]){if(void 0===f&&!(i in t))return!1}else{var l=new mt;if(n)var v=n(f,s,i,t,r,l);if(!(void 0===v?Te(s,f,3,n,l):v))return!1}}return!0};var $e=function(t){return t==t&&!G(t)};var Re=function(t){for(var r=er(t),e=r.length;e--;){var n=r[e],o=t[n];r[e]=[n,o,$e(o)]}return r};var Ce=function(t,r){return function(e){return null!=e&&(e[t]===r&&(void 0!==r||t in Object(e)))}};var Ve=function(t){var r=Re(t);return 1==r.length&&r[0][2]?Ce(r[0][0],r[0][1]):function(e){return e===t||De(e,t,r)}};var qe=function(t,r){return null!=t&&r in Object(t)};var We=function(t,r,e){for(var n=-1,o=(r=je(r,t)).length,u=!1;++n<o;){var a=we(r[n]);if(!(u=null!=t&&e(t,a)))break;t=t[a]}return u||++n!=o?u:!!(o=null==t?0:t.length)&&Dt(o)&&Tt(a,o)&&(Mt(t)||Bt(t))};var Ye=function(t,r){return null!=t&&We(t,r,qe)};var He=function(t,r){return ie(t)&&$e(r)?Ce(we(t),r):function(e){var n=_e(e,t);return void 0===n&&n===r?Ye(e,t):Te(r,n,3)}};var Je=function(t){return t};var Ke=function(t){return function(r){return null==r?void 0:r[t]}};var Qe=function(t){return function(r){return me(r,t)}};var Xe=function(t){return ie(t)?Ke(we(t)):Qe(t)};var Ze=function(t){return"function"==typeof t?t:null==t?Je:"object"==u(t)?Mt(t)?He(t[0],t[1]):Ve(t):Xe(t)};var tn=function(t){return function(r,e,n){for(var o=-1,u=Object(r),a=n(r),c=a.length;c--;){var i=a[t?c:++o];if(!1===e(u[i],i,u))break}return r}}();var rn=function(t,r){return function(e,n){if(null==e)return e;if(!rr(e))return t(e,n);for(var o=e.length,u=r?o:-1,a=Object(e);(r?u--:++u<o)&&!1!==n(a[u],u,a););return e}}((function(t,r){return t&&tn(t,r,er)}));var en=function(t,r){var e=-1,n=rr(t)?Array(t.length):[];return rn(t,(function(t,o,u){n[++e]=r(t,o,u)})),n};var nn=function(t,r){return(Mt(t)?he:en)(t,Ze(r))};var on=function(t){var r=null==t?0:t.length;return r?t[r-1]:void 0};var un=function(t,r,e){var n=-1,o=t.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var u=Array(o);++n<o;)u[n]=t[n+r];return u};var an=function(t,r){return r.length<2?t:me(t,un(r,0,-1))};var cn=function(t,r){return r=je(r,t),null==(t=an(t,r))||delete t[we(on(r))]},fn=Function.prototype,sn=Object.prototype,ln=fn.toString,vn=sn.hasOwnProperty,pn=ln.call(Object);var hn=function(t){if(!Pt(t)||"[object Object]"!=M(t))return!1;var r=gr(t);if(null===r)return!0;var e=vn.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&ln.call(e)==pn};var dn=function(t){return hn(t)?void 0:t},yn=S?S.isConcatSpreadable:void 0;var bn=function(t){return Mt(t)||Bt(t)||!!(yn&&t&&t[yn])};var gn=function t(r,e,n,o,u){var a=-1,c=r.length;for(n||(n=bn),u||(u=[]);++a<c;){var i=r[a];e>0&&n(i)?e>1?t(i,e-1,n,o,u):br(u,i):o||(u[u.length]=i)}return u};var jn=function(t){return(null==t?0:t.length)?gn(t,1):[]};var wn=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},mn=Math.max;var _n=function(t,r,e){return r=mn(void 0===r?t.length-1:r,0),function(){for(var n=arguments,o=-1,u=mn(n.length-r,0),a=Array(u);++o<u;)a[o]=n[r+o];o=-1;for(var c=Array(r+1);++o<r;)c[o]=n[o];return c[r]=e(a),wn(t,this,c)}};var On=function(t){return function(){return t}},xn=Ot?function(t,r){return Ot(t,"toString",{configurable:!0,enumerable:!1,value:On(r),writable:!0})}:Je,An=Date.now;var Sn=function(t){var r=0,e=0;return function(){var n=An(),o=16-(n-e);if(e=n,o>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(xn);var kn=function(t){return Sn(_n(t,void 0,jn),t+"")}((function(t,r){var e={};if(null==t)return e;var n=!1;r=he(r,(function(r){return r=je(r,t),n||(n=r.length>1),r})),kt(t,Or(t),e),n&&(e=ne(e,7,dn));for(var o=r.length;o--;)cn(e,r[o]);return e}));var En=function(t){return"string"==typeof t||!Mt(t)&&Pt(t)&&"[object String]"==M(t)},Pn=Ke("length"),Ln=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var zn=function(t){return Ln.test(t)},Fn="[\\ud800-\\udfff]",Nn="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Bn="\\ud83c[\\udffb-\\udfff]",Mn="[^\\ud800-\\udfff]",Gn="(?:\\ud83c[\\udde6-\\uddff]){2}",In="[\\ud800-\\udbff][\\udc00-\\udfff]",Un="(?:"+Nn+"|"+Bn+")"+"?",Tn="[\\ufe0e\\ufe0f]?"+Un+("(?:\\u200d(?:"+[Mn,Gn,In].join("|")+")[\\ufe0e\\ufe0f]?"+Un+")*"),Dn="(?:"+[Mn+Nn+"?",Nn,Gn,In,Fn].join("|")+")",$n=RegExp(Bn+"(?="+Bn+")|"+Dn+Tn,"g");var Rn=function(t){for(var r=$n.lastIndex=0;$n.test(t);)++r;return r};var Cn=function(t){return zn(t)?Rn(t):Pn(t)};var Vn=function(t){if(null==t)return 0;if(rr(t))return En(t)?Cn(t):t.length;var r=Br(t);return"[object Map]"==r||"[object Set]"==r?t.size:tr(t).length};function qn(){var t,r,e=new Promise((function(){t=arguments[0],r=arguments[1]}));return e.resolve=t,e.reject=r,e}var Wn=/^\s+|\s+$/g,Yn=/^[-+]0x[0-9a-f]+$/i,Hn=/^0b[01]+$/i,Jn=/^0o[0-7]+$/i,Kn=parseInt;var Qn=function(t){if("number"==typeof t)return t;if(ue(t))return NaN;if(G(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=G(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Wn,"");var e=Hn.test(t);return e||Jn.test(t)?Kn(t.slice(2),e?2:8):Yn.test(t)?NaN:+t};var Xn=function(t){return t?(t=Qn(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Zn=function(t){var r=Xn(t),e=r%1;return r==r?e?r-e:r:0};var to=function(t){return"number"==typeof t&&t==Zn(t)};function ro(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}function eo(t){var r=!1;return ro(t)?r=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(r=!0),r}function no(t){return eo(t)?Xn(t):0}var oo=A.isFinite,uo=Math.min;var ao=function(t){var r=Math[t];return function(t,e){if(t=Qn(t),(e=null==e?0:uo(Zn(e),292))&&oo(t)){var n=(ge(t)+"e").split("e"),o=r(n[0]+"e"+(+n[1]+e));return+((n=(ge(o)+"e").split("e"))[0]+"e"+(+n[1]-e))}return r(t)}}("round");function co(t){if(!eo(t))return 0;t=no(t);var r=ao(t);return"0"===String(r)?0:r}function io(t){return!!function(t){return!!eo(t)&&(t=no(t),to(t))}(t)&&co(t)>0}var fo="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),so=fo.length;function lo(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,r=[];t=io(t)?co(t):32;for(var e=0;e<t;e++)r[e]=fo[0|Math.random()*so];var n=r.join("");return n}function vo(t){return"[object Array]"===Object.prototype.toString.call(t)}var po=function(t,r,e){var n=null==t?0:t.length;return n?(r=e||void 0===r?1:Zn(r),un(t,r<0?0:r,n)):[]};function ho(t){var r=Object.prototype.toString.call(t);return"[object Function]"===r||"[object AsyncFunction]"===r}function yo(t,r){var e=qn();if(!vo(t))return e.reject("rs is not array"),e;ho(r)||(r=function(t){return t});var n=-1,o=[];return t.reduce((function(t,e){return t.then((function(t){return o.push(t),n+=1,ho(r)?r(e,n):e}))}),Promise.resolve()).then((function(t){o.push(t),o=po(o),e.resolve(o)})).catch((function(t){e.reject(t)})),e}var bo={useNewUrlParser:!0,useUnifiedTopology:!0};return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.url||(n.url="mongodb://127.0.0.1:27017"),n.db||(n.db="worm"),n.cl||(n.cl="test");var o=new t.EventEmitter,u=r.MongoClient;function c(){return f.apply(this,arguments)}function f(){return(f=i(a.mark((function t(){var r,e,o,c,i=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:{},e=qn(),t.next=4,u.connect(n.url,bo);case 4:return o=t.sent,c=o.db(n.db),c.collection(n.cl).find(r).toArray((function(t,r){t?e.reject(t):(r=nn(r,(function(t){return t=kn(t,"_id")})),e.resolve(r)),o.close()})),t.abrupt("return",e);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function s(t){return l.apply(this,arguments)}function l(){return(l=i(a.mark((function t(r){var e,c,i,f;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=oe(r),e=qn(),t.next=4,u.connect(n.url,bo);case 4:return c=t.sent,i=c.db(n.db),f=i.collection(n.cl),vo(r)||(r=[r]),r=nn(r,(function(t){return t.id||(t.id=lo()),t})),f.insertMany(r,(function(t,n){t?e.reject(t):n.insertedCount>0?(n=n.result,e.resolve(n),o.emit("change","insert",r,n)):e.reject(t),c.close()})),t.abrupt("return",e);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t){return p.apply(this,arguments)}function p(){return(p=i(a.mark((function t(r){var e,c,i,f,l,v,p,h,d=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=d.length>1&&void 0!==d[1]?d[1]:{},r=oe(r),c=_e(e,"autoInsert",!0),i=_e(e,"atomic",!1),f=qn(),t.next=7,u.connect(n.url,bo);case 7:return l=t.sent,v=l.db(n.db),p=v.collection(n.cl),vo(r)||(r=[r]),h=null,h=i?"findOneAndUpdate":"updateOne",yo(r,(function(t){var r=qn();return p[h]({id:t.id},{$set:t},(function(e,n){e?r.reject(e):(n.lastErrorObject&&(n.result={n:n.lastErrorObject.n,nModified:n.lastErrorObject.updatedExisting?1:0,ok:1}),c&&0===n.result.n?s(t).then((function(t){t.nInserted=1,r.resolve(t)})).catch((function(t){r.reject(t)})):r.resolve(n.result))})),r})).then((function(t){f.resolve(t),o.emit("change","save",r,t)})).catch((function(t){f.reject(t)})).finally((function(){l.close()})),t.abrupt("return",f);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){return d.apply(this,arguments)}function d(){return(d=i(a.mark((function t(r){var e,c,i,f;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=oe(r),e=qn(),t.next=4,u.connect(n.url,bo);case 4:return c=t.sent,i=c.db(n.db),f=i.collection(n.cl),vo(r)||(r=[r]),yo(r,(function(t){var r=qn();return f.deleteOne({id:t.id},(function(t,e){t?r.resolve(t):((e=e.result).nDeleted=1,r.resolve(e))})),r})).then((function(t){e.resolve(t),o.emit("change","del",r,t)})).catch((function(t){e.reject(t)})).finally((function(){c.close()})),t.abrupt("return",e);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(){return b.apply(this,arguments)}function b(){return(b=i(a.mark((function t(){var r,e,c,i,f=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=f.length>0&&void 0!==f[0]?f[0]:{},e=qn(),t.next=4,u.connect(n.url,bo);case 4:return c=t.sent,i=c.db(n.db),i.collection(n.cl).deleteMany(r,(function(t,r){t?e.resolve(t):(r=r.result,e.resolve(r),o.emit("change","delAll",null,r)),c.close()})),t.abrupt("return",e);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){return j.apply(this,arguments)}function j(){return(j=i(a.mark((function t(c){var i,f,s,l,v,p,h;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=qn(),f=lo(),s=Buffer.from(c),t.next=5,u.connect(n.url,bo);case 5:return l=t.sent,v=l.db(n.db),p=new r.GridFSBucket(v,{chunkSizeBytes:10485760,bucketName:n.cl}),(h=new e.Readable)._read=function(){},h.push(s),h.push(null),h.pipe(p.openUploadStream(f)).on("error",(function(t){i.reject(t),l.close()})).on("finish",(function(){var t={n:1,ok:1,id:f};i.resolve(t),o.emit("change","insertGfs",null,t),l.close()})),t.abrupt("return",i);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t){return m.apply(this,arguments)}function m(){return(m=i(a.mark((function t(e){var o,c,i,f,s,l;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=qn(),t.next=3,u.connect(n.url,bo);case 3:return c=t.sent,i=c.db(n.db),f=new r.GridFSBucket(i,{chunkSizeBytes:10485760,bucketName:n.cl}),s=Buffer.from(""),(l=f.openDownloadStreamByName(e)).on("data",(function(t){s=Buffer.concat([s,t])})),l.on("error",(function(t){o.reject(t),c.close()})),l.on("end",(function(){var t=new Uint8Array(s);s=null,o.resolve(t),c.close()})),t.abrupt("return",o);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return O.apply(this,arguments)}function O(){return(O=i(a.mark((function t(){var e,o,c,i,f,s=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:{},o=s.length>1&&void 0!==s[1]?s[1]:null,c=qn(),null!==o){t.next=9;break}return t.next=6,u.connect(n.url,bo);case 6:i=t.sent,f=i.db(n.db),o=new r.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:n.cl});case 9:return o.find(e).toArray((function(t,r){t?c.reject(t):c.resolve(r)})),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){return A.apply(this,arguments)}function A(){return(A=i(a.mark((function t(e){var c,i,f,s,l,v;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=qn(),t.next=3,u.connect(n.url,bo);case 3:return i=t.sent,f=i.db(n.db),s=new r.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:n.cl}),t.next=8,_({filename:e},s);case 8:return 0===(l=t.sent).length?(c.reject("can not find id"),i.close()):l.length>1?(c.reject("duplicate id"),i.close()):(v=l[0]._id,s.delete(v,(function(t){if(t)c.reject(t);else{var r={n:1,nDeleted:1,ok:1};c.resolve(r),o.emit("change","delGfs",null,r)}i.close()}))),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t,r){return k.apply(this,arguments)}function k(){return(k=i(a.mark((function t(r,e){var n;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=qn(),e.delete(r,(function(t){t?n.reject(t):n.resolve({n:1,nDeleted:1,ok:1})})),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(){return P.apply(this,arguments)}function P(){return(P=i(a.mark((function t(){var e,c,i,f,s,l,v,p,h=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.length>0&&void 0!==h[0]?h[0]:{},c=qn(),t.next=4,u.connect(n.url,bo);case 4:return i=t.sent,f=i.db(n.db),s=new r.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:n.cl}),t.next=9,_(e,s);case 9:return l=t.sent,v=Vn(l),p=nn(l,(function(t){return S(t._id,s)})),Promise.all(p).then((function(t){var r={n:v,ok:1};c.resolve(r),o.emit("change","delAllGfs",null,r)})).catch((function(t){c.reject(t)})).finally((function(){i.close()})),t.abrupt("return",c);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return o.select=c,o.insert=s,o.save=v,o.del=h,o.delAll=y,o.selectGfs=w,o.insertGfs=g,o.delGfs=x,o.delAllGfs=E,o}}));
//# sourceMappingURL=w-orm-mongodb.umd.js.map
